<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veiksma≈æod≈æio gal≈´nƒós sakiniuose - Kalbos Upƒó</title>
    <link rel="stylesheet" href="../../css/style.css">
    <style>
        body {
            font-family: 'OpenDyslexic', Arial, sans-serif;
            letter-spacing: 0.05em;
            background-color: #E8F4F8;
            line-height: 1.8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 15px;
            box-sizing: border-box;
        }

        .page-wrapper {
            width: 100%;
            max-width: 1000px;
        }

        .back-btn {
            display: inline-block;
            margin-bottom: 15px;
            padding: 12px 24px;
            background-color: #7CB3E9;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 20px;
            transition: background-color 0.3s;
        }
        
        .back-btn:hover {
            background-color: #4A90E2;
        }
        
        .student-info {
            background-color: #ffffff;
            padding: 18px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #4A90E2;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .change-name-btn {
            background-color: #4A90E2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'OpenDyslexic', Arial, sans-serif;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .change-name-btn:hover {
            background-color: #0D3B66;
        }

        .card {
            width: 100%;
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(26, 77, 122, 0.15);
            padding: 25px;
            border: 3px solid #4A90E2;
            display: none;
        }

        .card.active {
            display: block;
        }

        /* ATMINTINƒñS STILIAI */
        .cheatsheet h1 {
            text-align: center;
            color: #0D3B66;
            font-size: 2.1rem;
            margin-bottom: 15px;
        }

        .rule-box {
            background-color: #E8F4F8;
            padding: 15px;
            border-radius: 10px;
            border: 3px solid #4ECDC4;
            margin-bottom: 15px;
        }

        .rule-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0D3B66;
            margin-bottom: 15px;
        }

        .rule-content {
            font-size: 1.2rem;
            color: #1A4D7A;
            line-height: 1.8;
        }

        .examples-box {
            background-color: #ffffff;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #7CB3E9;
            margin-top: 15px;
        }

        .example-item {
            padding: 8px 0;
            font-size: 1.3rem;
        }

        .highlight {
            background-color: #fff9c4;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: #0D3B66;
        }
        /* U≈ΩDUOTIES STILIAI */
        .task-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .task-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #0D3B66;
            margin-bottom: 10px;
        }

        .task-progress {
            font-size: 1.2rem;
            color: #4A90E2;
            font-weight: bold;
        }

        .sentence-box {
            background-color: #E8F4F8;
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #7CB3E9;
            margin: 20px 0;
            font-size: 1.4rem;
            line-height: 2;
            text-align: center;
            color: #1A4D7A;
        }

        .verb-stem {
            font-weight: bold;
            color: #0D3B66;
            background-color: #ffffff;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .input-box {
            display: inline-block;
            margin: 0 5px;
        }

        .galune-input {
            width: 60px;
            font-size: 1.4rem;
            padding: 8px 12px;
            border: 3px solid #7CB3E9;
            border-radius: 8px;
            text-align: center;
            font-family: 'OpenDyslexic', Arial, sans-serif;
            font-weight: bold;
            color: #0D3B66;
            background-color: #ffffff;
            transition: all 0.3s;
        }

        .galune-input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.3);
        }

        .galune-input.correct {
            border-color: #27ae60;
            background-color: #d4edda;
            color: #155724;
        }

        .galune-input.incorrect {
            border-color: #e74c3c;
            background-color: #f8d7da;
            color: #721c24;
        }

        .feedback-message {
            text-align: center;
            margin-top: 20px;
            font-size: 1.3rem;
            font-weight: bold;
            min-height: 30px;
        }

        .feedback-correct {
            color: #27ae60;
        }

        .feedback-incorrect {
            color: #e74c3c;
        }

        .button-container {
            text-align: center;
            margin-top: 25px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .action-button {
            padding: 15px 35px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            color: white;
            border: none;
            border-radius: 10px;
            transition: all 0.3s;
            font-family: 'OpenDyslexic', Arial, sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4ECDC4, #27ae60);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4A90E2, #0D3B66);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* REZULTAT≈≤ STILIAI */
        .result-container {
            text-align: center;
            margin-top: 30px;
            font-size: 1.5rem;
            color: #1A4D7A;
        }

        .result-title {
            font-size: 2.2rem;
            font-weight: bold;
            color: #0D3B66;
            margin-bottom: 30px;
        }

        .result-details {
            margin-bottom: 20px;
        }

        .result-item {
            padding: 12px;
            margin: 10px 0;
            background-color: #ffffff;
            border-radius: 8px;
            font-size: 1.2rem;
        }

        .result-item.correct-item {
            border-left: 4px solid #27ae60;
        }

        .result-item.incorrect-item {
            border-left: 4px solid #e74c3c;
        }

        .total-score {
            font-size: 1.8rem;
            font-weight: bold;
            margin-top: 30px;
            padding: 25px;
            background-color: #E8F4F8;
            border-radius: 10px;
            border: 3px solid #4ECDC4;
        }

        .score-percentage {
            font-size: 3rem;
            margin-top: 15px;
        }

        .score-good {
            color: #27ae60;
        }

        .score-bad {
            color: #e74c3c;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .card {
                padding: 25px;
            }

            .cheatsheet h1 {
                font-size: 1.8rem;
            }

            .task-title {
                font-size: 1.5rem;
            }

            .sentence-box {
                font-size: 1.2rem;
                padding: 20px;
            }

            .galune-input {
                width: 50px;
                font-size: 1.2rem;
            }

            .action-button {
                font-size: 1.1rem;
                padding: 12px 25px;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <a href="../../index.html" class="back-btn">‚Üê GrƒØ≈æti ƒØ prad≈æiƒÖ</a>
        
        <div class="student-info">
            <span style="font-size: 18px; color: #1A4D7A;">
                Mokinys: <strong id="studentNameDisplay"></strong>
            </span>
            <button class="change-name-btn" onclick="changeName()">Keisti vardƒÖ</button>
        </div>

        <!-- KORTELƒñ 1: ATMINTINƒñ -->
        <div id="card-cheatsheet" class="card active cheatsheet">
            <h1>üìñ Veiksma≈æod≈æio gal≈´nƒós | <span style="color: #4A90E2;">KƒÖ veikia?</span></h1>
            
            <div class="rule-box">
                <div class="rule-title">Kai veiksma≈æodis atsako ƒØ klausimƒÖ <span style="background-color: #fff9c4; padding: 5px 15px; border-radius: 8px; border: 2px solid #4A90E2;">KƒÖ veikia?</span>, jis baigiasi gal≈´ne:</div>
                <div class="rule-content">
                    
                    <div class="examples-box">
                        <div class="example-item" style="padding: 8px; margin: 7px 0;">
                            <span class="highlight" style="font-size: 1.4rem; background-color: #fff9c4; padding: 8px 15px;">-ia</span> 
                            <span style="font-size: 1.3rem; margin-left: 15px;">‚Üí ≈æaid≈æ<strong>ia</strong>, pie≈°<strong>ia</strong>, klaus<strong>ia</strong>, ≈°vilp<strong>ia</strong></span>
                        </div>
                        
                        <div class="example-item" style="padding: 8px; margin: 7px 0;">
                            <span class="highlight" style="font-size: 1.4rem; background-color: #fff9c4; padding: 8px 15px;">-a</span> 
                            <span style="font-size: 1.3rem; margin-left: 15px;">‚Üí dirb<strong>a</strong>, mieg<strong>a</strong>, krent<strong>a</strong>, ≈°luoj<strong>a</strong></span>
                        </div>
                        
                        <div class="example-item" style="padding: 8px; margin: 7px 0;">
                            <span class="highlight" style="font-size: 1.4rem; background-color: #fff9c4; padding: 8px 15px;">-i</span> 
                            <span style="font-size: 1.3rem; margin-left: 15px;">‚Üí gird<strong>i</strong>, tup<strong>i</strong>, tur<strong>i</strong></span>
                        </div>
                        
                        <div class="example-item" style="padding: 8px; margin: 7px 0;">
                            <span class="highlight" style="font-size: 1.4rem; background-color: #fff9c4; padding: 8px 15px;">-o</span> 
                            <span style="font-size: 1.3rem; margin-left: 15px;">‚Üí mat<strong>o</strong>, stat<strong>o</strong>, rod<strong>o</strong></span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px; padding: 20px; background-color: #ffffff; border-radius: 10px; border: 2px solid #7CB3E9;">
                        <p style="font-size: 1.2rem; color: #1A4D7A; margin: 0;">
                            <strong>Atkreipk dƒómesƒØ:<strong> veiksma≈æodis, atsakantis ƒØ klausimƒÖ <span style="color: #4A90E2; font-weight: bold;">KƒÖ veikia?</span> niekada nesibaigia gal≈´ne <span style="color: #e74c3c; font-weight: bold;">-e!</span>
                        </p>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background-color: #E8F4F8; border-radius: 8px; font-size: 1.0rem; color: #1A4D7A">
                        ‚ÑπÔ∏è Tai yra esamojo laiko, vienaskaitos ir daugiskaitos treƒçiojo asmens veiksma≈æod≈æiai.
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button onclick="showCard('card-task-1')" class="action-button btn-primary">‚ñ∂Ô∏è Pradƒóti u≈æduotis</button>
            </div>
        </div>

        <!-- U≈ΩDUOƒåI≈≤ KORTELƒñS (bus sugeneruotos dinami≈°kai) -->
        <div id="task-cards-container"></div>

        <!-- KORTELƒñ: REZULTATAI -->
        <div id="card-results" class="card">
            <div class="result-title">üéâ U≈æduoties rezultatai</div>
            <div class="result-container">
                <div class="result-details" id="result-details"></div>
                <div class="total-score" id="total-score"></div>
            </div>
            <div class="button-container">
                <button onclick="location.reload()" class="action-button btn-success">üîÑ Pradƒóti i≈° naujo</button>
            </div>
        </div>
    </div>

    <script>
        // --- Vard≈≥ valdymas ---
        function showNamePrompt() {
            const studentName = localStorage.getItem('studentName');
            
            if (!studentName) {
                const name = prompt('ƒÆvesk savo vardƒÖ:');
                if (name && name.trim() !== '') {
                    localStorage.setItem('studentName', name.trim());
                    return name.trim();
                } else {
                    alert('Pra≈°ome ƒØvesti vardƒÖ, kad galƒótumƒóte pradƒóti u≈æduotƒØ.');
                    return showNamePrompt();
                }
            }
            return studentName;
        }

        function changeName() {
            localStorage.removeItem('studentName');
            const newName = showNamePrompt();
            alert(`Vardas pakeistas ƒØ: ${newName}`);
            location.reload();
        }

        function sendResultToSheet(taskName, score) {
            const studentName = localStorage.getItem('studentName') || 'Ne≈æinomas';
            const timestamp = new Date().toLocaleString('lt-LT');
        
            const data = {
                name: studentName,
                task: taskName,
                score: score,
                timestamp: timestamp
            };
        
            console.log('Siunƒçiamas rezultatas:', data);
        
            fetch('https://script.google.com/macros/s/AKfycbzhXP3hJ6NBLOld6Gbg-tlN-Tk8BPoxx32tx9j-iKCJChVyeOpZiDyGu9g2cm6Vl0uf/exec', {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                console.log('Rezultatas sƒókmingai i≈°si≈≥stas ƒØ Google Sheets! ‚úÖ');
            })
            .catch(error => {
                console.error('Klaida siunƒçiant rezultatƒÖ:', error);
            });
        }
        
        const studentName = showNamePrompt();
        document.getElementById('studentNameDisplay').textContent = studentName;

        // --- U≈ΩDUOƒåI≈≤ DUOMENYS ---
        const tasks = [
            { id: 1, sentence: "Vaikas [VERB] su kamuoliu kieme.", stem: "≈æaid≈æ", correct: "ia", full: "≈æaid≈æia" },
            { id: 2, sentence: "Mergaitƒó [VERB] gra≈æ≈≥ paveikslƒÖ.", stem: "pie≈°", correct: "ia", full: "pie≈°ia" },
            { id: 3, sentence: "Katƒó [VERB] ant sofos.", stem: "snaud≈æ", correct: "ia", full: "snaud≈æia" },
            { id: 4, sentence: "Vƒójas [VERB] pro langƒÖ.", stem: "puƒç", correct: "ia", full: "puƒçia" },
            { id: 5, sentence: "≈Ωaltys [VERB] ≈æolƒóje.", stem: "≈°nyp≈°ƒç", correct: "ia", full: "≈°nyp≈°ƒçia" },
            { id: 6, sentence: "Lietus [VERB] ƒØ stogƒÖ.", stem: "pliaup", correct: "ia", full: "pliaupia" },
            { id: 7, sentence: "Mokinys [VERB] mokytojƒÖ.", stem: "klaus", correct: "ia", full: "klausia" },
            { id: 8, sentence: "Pauk≈°tis [VERB] medyje.", stem: "≈°vilp", correct: "ia", full: "≈°vilpia" },
            { id: 9, sentence: "K≈´dikis linksmai [VERB].", stem: "kryk≈°ƒç", correct: "ia", full: "kryk≈°ƒçia" },
            { id: 10, sentence: "Berniukas [VERB] pagalbos.", stem: "≈°auk", correct: "ia", full: "≈°aukia" },
            { id: 11, sentence: "K≈´dikis [VERB] naktimis.", stem: "verk", correct: "ia", full: "verkia" },
            { id: 12, sentence: "Mokinys [VERB] mokytojo balsƒÖ.", stem: "gird", correct: "i", full: "girdi" },
            { id: 13, sentence: "Vaikas [VERB] pauk≈°tƒØ danguje.", stem: "mat", correct: "o", full: "mato" },
            { id: 14, sentence: "≈Ωmogus [VERB] biure.", stem: "dirb", correct: "a", full: "dirba" },
            { id: 15, sentence: "≈†uo [VERB] b≈´doje.", stem: "mieg", correct: "a", full: "miega" },
            { id: 16, sentence: "Lapas [VERB] nuo med≈æio.", stem: "krent", correct: "a", full: "krenta" },
            { id: 17, sentence: "Kƒôstutis [VERB] grindis.", stem: "≈°luoj", correct: "a", full: "≈°luoja" },
            { id: 18, sentence: "Sodininkas [VERB] ≈æolƒô.", stem: "pjaun", correct: "a", full: "pjauna" },
            { id: 19, sentence: "Varna [VERB] ant tvoros.", stem: "tup", correct: "i", full: "tupi" },
            { id: 20, sentence: "Mokinys [VERB] daug knyg≈≥.", stem: "tur", correct: "i", full: "turi" }
        ];

        let currentTaskIndex = 0;
        let userAnswers = [];
        // --- KORTELI≈≤ GENERAVIMAS ---
        function generateTaskCards() {
            const container = document.getElementById('task-cards-container');
            
            tasks.forEach((task, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.id = `card-task-${task.id}`;
                cardDiv.className = 'card';
                
                const sentenceWithInput = task.sentence.replace('[VERB]', 
                    `<span class="verb-stem">${task.stem}</span><span class="input-box"><input type="text" class="galune-input" id="input-${task.id}" maxlength="4" autocomplete="off"></span>`
                );
                
                cardDiv.innerHTML = `
                    <div class="task-header">
                        <div class="task-title">ƒÆra≈°yk teisingƒÖ gal≈´nƒô</div>
                        <div class="task-progress">${index + 1} / ${tasks.length}</div>
                    </div>
                    
                    <div class="sentence-box">
                        ${sentenceWithInput}
                    </div>
                    
                    <div class="feedback-message" id="feedback-${task.id}"></div>
                    
                    <div class="button-container">
                        <button onclick="checkAnswer(${task.id})" class="action-button btn-primary" id="check-btn-${task.id}">‚úÖ Patikrinti</button>
                    </div>
                `;
                
                container.appendChild(cardDiv);
            });
        }

        // --- KORTELI≈≤ RODYMAS ---
        function showCard(cardId) {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById(cardId).classList.add('active');
            
            // Fokusuoti ƒØ input laukƒÖ
            if (cardId.startsWith('card-task-')) {
                const taskId = parseInt(cardId.split('-')[2]);
                setTimeout(() => {
                    const input = document.getElementById(`input-${taskId}`);
                    if (input) input.focus();
                }, 100);
            }
        }

        // --- ATSAKYMO TIKRINIMAS ---
        function checkAnswer(taskId) {
            const task = tasks.find(t => t.id === taskId);
            const input = document.getElementById(`input-${taskId}`);
            const feedback = document.getElementById(`feedback-${taskId}`);
            const checkBtn = document.getElementById(`check-btn-${taskId}`);
            
            const userAnswer = input.value.trim();
            const isCorrect = userAnswer === task.correct;
            
            // I≈°saugoti atsakymƒÖ
            userAnswers.push({
                taskId: taskId,
                sentence: task.sentence.replace('[VERB]', task.full),
                userAnswer: userAnswer,
                correctAnswer: task.correct,
                isCorrect: isCorrect
            });
            
            // Rodyti feedback
            if (isCorrect) {
                input.classList.add('correct');
                input.classList.remove('incorrect');
                feedback.innerHTML = '‚úÖ <span class="feedback-correct">Teisingai!</span>';
            } else {
                input.classList.add('incorrect');
                input.classList.remove('correct');
                feedback.innerHTML = `‚ùå <span class="feedback-incorrect">Neteisinga. Teisingas atsakymas: <strong>${task.correct}</strong></span>`;
            }
            
            // I≈°jungti input ir pakeisti mygtukƒÖ
            input.disabled = true;
            checkBtn.style.display = 'none';
            
            const buttonContainer = document.getElementById(`card-task-${taskId}`).querySelector('.button-container');
            const nextBtn = document.createElement('button');
            nextBtn.className = 'action-button btn-secondary';
            
            if (taskId < tasks.length) {
                nextBtn.textContent = '‚û°Ô∏è Toliau';
                nextBtn.onclick = () => showCard(`card-task-${taskId + 1}`);
            } else {
                nextBtn.textContent = 'üèÅ Rezultatai';
                nextBtn.onclick = () => showResults();
            }
            
            buttonContainer.appendChild(nextBtn);
        }
        // --- REZULTAT≈≤ RODYMAS ---
        function showResults() {
            showCard('card-results');
            
            const resultDetails = document.getElementById('result-details');
            const totalScoreEl = document.getElementById('total-score');
            
            let correctCount = 0;
            let detailsHTML = '';
            
            userAnswers.forEach((answer, index) => {
                if (answer.isCorrect) correctCount++;
                
                const itemClass = answer.isCorrect ? 'correct-item' : 'incorrect-item';
                const icon = answer.isCorrect ? '‚úÖ' : '‚ùå';
                const statusText = answer.isCorrect 
                    ? `<span style="color: #27ae60;">Teisingai</span>` 
                    : `<span style="color: #e74c3c;">Neteisingai (turƒójo b≈´ti: <strong>${answer.correctAnswer}</strong>)</span>`;
                
                detailsHTML += `
                    <div class="result-item ${itemClass}">
                        ${icon} <strong>U≈æduotis ${index + 1}:</strong> ${statusText}
                    </div>
                `;
            });
            
            resultDetails.innerHTML = detailsHTML;
            
            const totalTasks = tasks.length;
            const percentage = Math.round((correctCount / totalTasks) * 100);
            const scoreClass = percentage >= 70 ? 'score-good' : 'score-bad';
            
            totalScoreEl.innerHTML = `
                <div>Teisingai atsakyta: <strong>${correctCount} / ${totalTasks}</strong></div>
                <div class="score-percentage ${scoreClass}">${percentage}%</div>
            `;
            
            // Si≈≥sti rezultatus ƒØ Google Sheets
            sendResultToSheet('L0404 Veiksma≈æod≈æio gal≈´nƒó (KƒÖ veikia?) | ƒÆra≈°yti', percentage);
        }

        // --- ENTER KLAVI≈†O PALAIKYMAS ---
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeCard = document.querySelector('.card.active');
                if (activeCard && activeCard.id.startsWith('card-task-')) {
                    const taskId = parseInt(activeCard.id.split('-')[2]);
                    const checkBtn = document.getElementById(`check-btn-${taskId}`);
                    if (checkBtn && checkBtn.style.display !== 'none') {
                        checkAnswer(taskId);
                    }
                }
            }
        });

        // --- INICIALIZACIJA ---
        generateTaskCards();
    </script>
</body>
</html>

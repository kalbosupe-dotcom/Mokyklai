<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mejozƒó ir Mitozƒó: Savybi≈≥ Klasifikavimas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
        }
        .container-wrapper {
            max-width: 650px; /* ≈†iek tiek platesnis */
            margin: 20px auto;
            padding: 20px;
        }
        .card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 30px;
            border: 3px solid #60a5fa; /* blue-400 */
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .question-box {
            background-color: #dbeafe; /* blue-100 */
            padding: 20px;
            border-radius: 8px;
            font-size: 1.4rem;
            font-weight: 600;
            text-align: center;
            color: #1e40af; /* blue-700 */
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        /* 1. SKIRTINGOS SPALVOS PASIRINKIMO MYGTUKAMS */
        .option-btn {
            color: white;
            font-weight: 700;
            padding: 15px;
            border-radius: 8px;
            transition: background-color 0.2s, transform 0.1s, border 0.2s;
            cursor: pointer;
            margin: 10px 0;
            font-size: 1.2rem;
            text-align: center;
        }
        /* Mejozƒós mygtuko stilius */
        .btn-mejoze {
            background-color: #6366f1; /* Indigo-500 */
        }
        .btn-mejoze:hover:not(.disabled) {
            background-color: #4f46e5; /* Indigo-600 */
            transform: translateY(-2px);
        }
        /* Mitozƒós mygtuko stilius */
        .btn-mitoze {
            background-color: #3b82f6; /* Blue-500 */
        }
        .btn-mitoze:hover:not(.disabled) {
            background-color: #2563eb; /* Blue-600 */
            transform: translateY(-2px);
        }
        /* Bendra teisingo/neteisingo atsakymo logika */
        .option-btn.correct {
            background-color: #10b981; /* ≈Ωalia */
        }
        .option-btn.incorrect {
            background-color: #ef4444; /* Raudona */
        }
        .option-btn.selected-border {
             border: 3px solid #f59e0b; /* Geltona / Oran≈æinƒó */
        }

        .disabled {
            pointer-events: none;
            opacity: 0.8;
        }
        
        /* Vir≈°utinis informacijos blokas */
        .header-row {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }
        .back-btn {
            display: inline-flex;
            align-items: center;
            background-color: #93c5fd; /* blue-300 */
            color: #1e3a8a; /* blue-800 */
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 8px;
            transition: background-color 0.2s;
            text-decoration: none;
        }
        .back-btn:hover {
            background-color: #60a5fa; /* blue-400 */
        }
        .student-info {
            background-color: #ffffff;
            padding: 10px 20px;
            border-radius: 8px;
            flex-grow: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #d1d5db; /* gray-300 */
        }
        .change-name-btn {
            background-color: #60a5fa; /* blue-400 */
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        .change-name-btn:hover {
            background-color: #3b82f6; /* blue-500 */
        }
        
    </style>
</head>
<body>

<div class="container-wrapper">

    <div class="header-row">
        <a href="/Mokyklai/" class="back-btn">‚Üê GrƒØ≈æti ƒØ prad≈æiƒÖ</a>
        <div class="student-info">
            Mokinys: <strong id="studentNameDisplay"></strong>
            <button class="change-name-btn" onclick="changeName()">Keisti vardƒÖ</button>
        </div>
    </div>
    
    <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-6">
        Mejozƒó ar Mitozƒó?
    </h1>

    <div class="card" id="test-card">
        
        <div class="mb-6">
            <p class="text-lg font-semibold text-gray-500 mb-2 text-center" id="question-count">
                Klausimas 1 i≈° 12
            </p>
            <div class="question-box" id="question-text">
                Savybƒós tekstas bus ƒçia.
            </div>
        </div>

        <div class="flex flex-col space-y-4" id="options-container">
            <button class="option-btn btn-mejoze" data-type="Mejoze">Mejozƒó</button>
            <button class="option-btn btn-mitoze" data-type="Mitoze">Mitozƒó</button>
        </div>

        <div class="mt-8 text-center">
            <div id="feedback-message" class="text-xl font-bold min-h-[30px] mb-4"></div>
            <button id="action-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-xl transition-colors">
                Patikrinti
            </button>
        </div>
    </div>

    <div class="card hidden mt-6" id="results-card">
        <h2 class="text-2xl font-bold text-center text-blue-700 mb-4">
            üéâ Rezultatai
        </h2>
        <p class="text-center text-xl font-semibold mb-6">
            Teisingai atsakyta: <span id="final-score" class="text-green-600"></span>
        </p>
        <div id="result-details" class="space-y-3 max-h-60 overflow-y-auto p-2 border rounded-md">
            </div>
        <button onclick="location.reload()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg text-lg mt-6">
            Pradƒóti i≈° naujo
        </button>
    </div>

</div>

<script>
    // 3. GOOGLE SHEETS URL IR DUOMENYS
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbzhXP3hJ6NBLOld6Gbg-tlN-Tk8BPoxx32tx9j-iKCJChVyeOpZiDyGu9g2cm6Vl0uf/exec';
    const TASK_ID = 'B0001 Mejozƒó vs Mitozƒó | Klasifikacija';

    const DATA = [
        { savybe: "Susidaro lytinƒós lƒÖstelƒós.", tipas: "Mejoze" },
        { savybe: "Susidaro k≈´no lƒÖstelƒós.", tipas: "Mitoze" },
        { savybe: "I≈° vienos motininƒós lƒÖstelƒós susidaro keturios dukterinƒós lƒÖstelƒós.", tipas: "Mejoze" },
        { savybe: "I≈° vienos motininƒós lƒÖstelƒós susidaro dvi dukterinƒós lƒÖstelƒós.", tipas: "Mitoze" },
        { savybe: "Susidariusios lƒÖstelƒós yra skirtingos.", tipas: "Mejoze" },
        { savybe: "Susidariusios lƒÖstelƒós yra geneti≈°kai identi≈°kos.", tipas: "Mitoze" },
        { savybe: "Susidariusi≈≥ lƒÖsteli≈≥ branduoliai turi skirtingƒÖ paveldimƒÖjƒÖ informacijƒÖ.", tipas: "Mejoze" },
        { savybe: "Susidariusi≈≥ lƒÖsteli≈≥ branduoliai turi vienodƒÖ paveldimƒÖjƒÖ informacijƒÖ.", tipas: "Mitoze" },
        { savybe: "Branduolys dalijasi du kartus i≈° eilƒós.", tipas: "Mejoze" },
        { savybe: "Branduolys dalijasi vienƒÖ kartƒÖ.", tipas: "Mitoze" },
        { savybe: "Vyksta subrendusiame organizme.", tipas: "Mejoze" },
        { savybe: "Vyksta ƒØvairaus am≈æiaus organizmuose.", tipas: "Mitoze" }
    ];
    const totalQuestions = DATA.length; // Dabar 12
    
    // 4. B≈™SENA
    const questionTextEl = document.getElementById('question-text');
    const questionCountEl = document.getElementById('question-count');
    const optionsContainer = document.getElementById('options-container');
    const actionBtn = document.getElementById('action-btn');
    const feedbackMessageEl = document.getElementById('feedback-message');
    const testCard = document.getElementById('test-card');
    const resultsCard = document.getElementById('results-card');
    const finalScoreEl = document.getElementById('final-score');
    const resultDetailsEl = document.getElementById('result-details');
    const studentNameDisplay = document.getElementById('studentNameDisplay');
    
    let currentQuestions = []; 
    let currentQuestionIndex = 0;
    let score = 0;
    let isAnswerChecked = false;
    let selectedAnswer = null;
    let userAnswersLog = []; // Detaliai saugome atsakymus

    // PAGALBINƒñS FUNKCIJOS
    
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function sendResultToSheet(taskName, score) {
        const studentName = localStorage.getItem('studentName') || 'Ne≈æinomas';
        const timestamp = new Date().toLocaleString('lt-LT');
        
        const data = {
            name: studentName,
            task: taskName,
            score: score,
            timestamp: timestamp
        };
        
        fetch(SHEET_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(() => {
            console.log('Rezultatas sƒókmingai i≈°si≈≥stas ƒØ Google Sheets! ‚úÖ');
        })
        .catch(error => {
            console.error('Klaida siunƒçiant rezultatƒÖ:', error);
        });
    }
    
    function showNamePrompt() {
        let studentName = localStorage.getItem('studentName');
        
        if (!studentName) {
            let name = prompt('ƒÆveskite savo vardƒÖ:');
            if (name && name.trim() !== '') {
                localStorage.setItem('studentName', name.trim());
                studentName = name.trim();
            } else {
                alert('Pra≈°ome ƒØvesti vardƒÖ, kad galƒótumƒóte pradƒóti u≈æduotƒØ.');
                return showNamePrompt();
            }
        }
        studentNameDisplay.textContent = studentName;
        return studentName;
    }

    function changeName() {
        localStorage.removeItem('studentName');
        showNamePrompt();
        location.reload();
    }

    // PAGRINDINƒñ LOGIKA

    function initializeTest() {
        showNamePrompt();
        // KLAUSIMAI SUMAI≈†OMI KIEKVIENƒÑ KARTƒÑ
        currentQuestions = shuffleArray([...DATA]); 
        currentQuestionIndex = 0;
        score = 0;
        userAnswersLog = [];
        showQuestion();
    }

    function showQuestion() {
        if (currentQuestionIndex >= currentQuestions.length) {
            showResults();
            return;
        }

        const question = currentQuestions[currentQuestionIndex];
        
        // Atnaujiname UI
        questionCountEl.textContent = `Klausimas ${currentQuestionIndex + 1} i≈° ${totalQuestions}`;
        questionTextEl.textContent = question.savybe;
        feedbackMessageEl.textContent = '';
        actionBtn.textContent = 'Patikrinti';
        actionBtn.onclick = checkAnswer;

        isAnswerChecked = false;
        selectedAnswer = null;

        // Atstatome mygtukus
        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.remove('correct', 'incorrect', 'disabled', 'selected-border');
            btn.onclick = handleOptionClick;
        });
    }

    function handleOptionClick(event) {
        if (isAnswerChecked) return;
        
        // Pa≈°aliname pasirinkimƒÖ nuo vis≈≥ mygtuk≈≥
        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.remove('selected-border');
        });

        // Pa≈æymime pasirinktƒÖ mygtukƒÖ
        event.target.classList.add('selected-border');
        selectedAnswer = event.target.dataset.type;
    }

    function checkAnswer() {
        if (!selectedAnswer) {
            feedbackMessageEl.innerHTML = '<span class="text-red-500">‚ùå Pasirinkite atsakymƒÖ!</span>';
            return;
        }

        isAnswerChecked = true;
        const currentQuestion = currentQuestions[currentQuestionIndex];
        const correctType = currentQuestion.tipas;
        const isCorrect = selectedAnswer === correctType;

        // I≈°saugome atsakymƒÖ log'e
        userAnswersLog.push({
            savybe: currentQuestion.savybe,
            pasirinkimas: selectedAnswer,
            teisingas: correctType,
            isCorrect: isCorrect
        });

        // Pa≈æymime teisingƒÖ/neteisingƒÖ mygtukƒÖ
        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.add('disabled');
            btn.classList.remove('selected-border');

            if (btn.dataset.type === correctType) {
                btn.classList.add('correct');
            } else if (btn.dataset.type === selectedAnswer) {
                btn.classList.add('incorrect');
            }
        });

        if (isCorrect) {
            score++;
            feedbackMessageEl.innerHTML = '<span class="text-green-600">‚úÖ Teisingai!</span>';
        } else {
            feedbackMessageEl.innerHTML = '<span class="text-red-500">‚ùå Neteisingai. Teisingas atsakymas pa≈æymƒótas ≈æalia spalva.</span>';
        }

        // Paruo≈°iame mygtukƒÖ kitam klausimui
        actionBtn.textContent = (currentQuestionIndex < totalQuestions - 1) ? 'Toliau' : 'Rezultatai';
        actionBtn.onclick = nextQuestion;
    }

    function nextQuestion() {
        currentQuestionIndex++;
        selectedAnswer = null;
        showQuestion();
    }

    function showResults() {
        testCard.classList.add('hidden');
        resultsCard.classList.remove('hidden');

        const percentage = Math.round((score / totalQuestions) * 100);
        finalScoreEl.textContent = `${score} i≈° ${totalQuestions} (${percentage}%)`;
        finalScoreEl.classList.add(percentage >= 70 ? 'text-green-600' : 'text-red-600');

        // Generuojame i≈°samiƒÖ atsakym≈≥ suvestinƒô
        let detailsHTML = '';
        userAnswersLog.forEach((answer, index) => {
            const status = answer.isCorrect ? 'Teisingai' : 'Neteisingai';
            const statusClass = answer.isCorrect ? 'text-green-700' : 'text-red-700';

            detailsHTML += `
                <div class="p-3 rounded-md border ${answer.isCorrect ? 'border-green-300 bg-green-50' : 'border-red-300 bg-red-50'}">
                    <p class="font-bold text-gray-800">${index + 1}. ${answer.savybe}</p>
                    <p class="${statusClass} font-semibold mt-1">
                        Atsakymas: ${answer.teisingas} (${status})
                    </p>
                </div>
            `;
        });

        resultDetailsEl.innerHTML = detailsHTML;
        
        // 3. I≈†SIUNƒåIAME REZULTATUS ƒÆ GOOGLE SHEETS
        sendResultToSheet(TASK_ID, percentage);
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // Kad funkcija b≈´t≈≥ pasiekiama i≈° HTML mygtuko
    window.changeName = changeName;

    // Pradinis paleidimas
    initializeTest();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MejozÄ— ir MitozÄ—: SavybiÅ³ Klasifikavimas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
        }
        .container-wrapper {
            max-width: 650px;
            margin: 20px auto;
            padding: 20px;
        }
        .card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 30px;
            border: 3px solid #60a5fa; /* blue-400 */
            min-height: 400px;
            display: none; /* Viskas paslÄ—pta, rodoma per JS */
            flex-direction: column;
            justify-content: space-between;
        }
        .card.active {
            display: flex;
        }
        .question-box {
            background-color: #dbeafe; /* blue-100 */
            padding: 20px;
            border-radius: 8px;
            font-size: 1.4rem;
            font-weight: 600;
            text-align: center;
            color: #1e40af; /* blue-700 */
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        /* 1. SKIRTINGOS SPALVOS PASIRINKIMO MYGTUKAMS */
        .option-btn {
            color: white;
            font-weight: 700;
            padding: 15px;
            border-radius: 8px;
            transition: background-color 0.2s, transform 0.1s, border 0.2s;
            cursor: pointer;
            margin: 10px 0;
            font-size: 1.2rem;
            text-align: center;
        }
        .btn-mejoze {
            background-color: #6366f1; /* Indigo-500 */
        }
        .btn-mejoze:hover:not(.disabled) {
            background-color: #4f46e5; /* Indigo-600 */
            transform: translateY(-2px);
        }
        .btn-mitoze {
            background-color: #3b82f6; /* Blue-500 */
        }
        .btn-mitoze:hover:not(.disabled) {
            background-color: #2563eb; /* Blue-600 */
            transform: translateY(-2px);
        }
        .option-btn.correct {
            background-color: #10b981; /* Å½alia */
        }
        .option-btn.incorrect {
            background-color: #ef4444; /* Raudona */
        }
        .option-btn.selected-border {
             border: 3px solid #f59e0b; /* Geltona / OranÅ¾inÄ— */
        }

        .disabled {
            pointer-events: none;
            opacity: 0.8;
        }
        
        /* VirÅ¡utinis informacijos blokas */
        .header-row {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }
        .back-btn {
            display: inline-flex;
            align-items: center;
            background-color: #93c5fd; /* blue-300 */
            color: #1e3a8a; /* blue-800 */
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 8px;
            transition: background-color 0.2s;
            text-decoration: none;
        }
        .back-btn:hover {
            background-color: #60a5fa; /* blue-400 */
        }
        .student-info {
            background-color: #ffffff;
            padding: 10px 20px;
            border-radius: 8px;
            flex-grow: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #d1d5db; /* gray-300 */
        }
        .change-name-btn {
            background-color: #60a5fa; /* blue-400 */
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        .change-name-btn:hover {
            background-color: #3b82f6; /* blue-500 */
        }
        
        /* LentelÄ—s stiliai (AtmintiÄ—) */
        .memo-table {
            width: 100%;
            border-collapse: collapse;
        }
        .memo-table th, .memo-table td {
            border: 1px solid #e5e7eb; /* gray-200 */
            padding: 10px;
            text-align: left;
            font-size: 1rem;
        }
        .memo-table th {
            background-color: #f3f4f6; /* gray-100 */
            font-weight: 700;
            color: #1f2937; /* gray-800 */
        }
        .memo-table tr:nth-child(even) {
            background-color: #f9fafb; /* gray-50 */
        }
        .task-description {
            background-color: #e0f2f1; /* teal-100 */
            padding: 15px 25px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 5px solid #14b8a6; /* teal-500 */
        }
        .task-description ol {
            list-style: decimal;
            list-style-position: inside;
            padding-left: 0;
            line-height: 1.6;
        }
        .task-description strong {
            font-weight: 700;
        }
    </style>
</head>
<body>

<div class="container-wrapper">

    <div class="header-row">
        <a href="/Mokyklai/" class="back-btn">â† GrÄ¯Å¾ti Ä¯ pradÅ¾iÄ…</a>
        <div class="student-info">
            Mokinys: <strong id="studentNameDisplay"></strong>
            <button class="change-name-btn" onclick="changeName()">Keisti vardÄ…</button>
        </div>
    </div>
    
    <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-6">
        MejozÄ— ar MitozÄ—?
    </h1>

    <div class="card active" id="memo-card">
        <div class="flex flex-col h-full">
             <h2 class="text-2xl font-bold text-center text-blue-700 mb-4">
                ğŸ“š AtmintinÄ—: MejozÄ— ir MitozÄ—
            </h2>
            <div class="task-description">
                <h3 class="font-extrabold text-lg text-teal-700 mb-2">UÅ½DUOTIS: SusipaÅ¾ink su informacija</h3>
                <ol>
                    <li><strong>PerÅ¾iÅ«rÄ—k</strong> palyginimo lentelÄ™.</li>
                    <li><strong>Ä®simink</strong> MitozÄ—s ir MejozÄ—s savybiÅ³ skirtumus.</li>
                    <li>Paspausk "PradÄ—ti testÄ…".</li>
                </ol>
            </div>
            
            <div class="overflow-x-auto mb-6 flex-grow">
                <table class="memo-table">
                    <thead>
                        <tr>
                            <th>MejozÄ—</th>
                            <th>MitozÄ—</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Susidaro lytinÄ—s lÄ…stelÄ—s.</td><td>Susidaro kÅ«no lÄ…stelÄ—s.</td></tr>
                        <tr><td>IÅ¡ vienos motininÄ—s lÄ…stelÄ—s susidaro keturios dukterinÄ—s lÄ…stelÄ—s.</td><td>IÅ¡ vienos motininÄ—s lÄ…stelÄ—s susidaro dvi dukterinÄ—s lÄ…stelÄ—s.</td></tr>
                        <tr><td>Susidariusios lÄ…stelÄ—s yra skirtingos.</td><td>Susidariusios lÄ…stelÄ—s yra genetiÅ¡kai identiÅ¡kos.</td></tr>
                        <tr><td>SusidariusiÅ³ lÄ…steliÅ³ branduoliai turi skirtingÄ… paveldimÄ…jÄ… informacijÄ….</td><td>SusidariusiÅ³ lÄ…steliÅ³ branduoliai turi vienodÄ… paveldimÄ…jÄ… informacijÄ….</td></tr>
                        <tr><td>Branduolys dalijasi du kartus iÅ¡ eilÄ—s.</td><td>Branduolys dalijasi vienÄ… kartÄ….</td></tr>
                        <tr><td>Vyksta subrendusiame organizme.</td><td>Vyksta Ä¯vairaus amÅ¾iaus organizmuose.</td></tr>
                    </tbody>
                </table>
            </div>
            
            <button id="start-test-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg text-xl transition-colors mt-auto">
                PradÄ—ti testÄ…
            </button>
        </div>
    </div>

    <div class="card" id="test-card">
        
        <div class="task-description">
            <h3 class="font-extrabold text-lg text-teal-700 mb-2">UÅ½DUOTIS: Priskirk savybÄ™</h3>
            <ol>
                <li><strong>Perskaityk</strong> pateiktÄ… savybÄ™.</li>
                <li><strong>Priskirk</strong> jÄ… Mitozei arba Mejozei.</li>
                <li>Paspausk "Patikrinti".</li>
            </ol>
        </div>
        
        <div class="mb-6">
            <p class="text-lg font-semibold text-gray-500 mb-2 text-center" id="question-count">
                Klausimas 0 iÅ¡ 12
            </p>
            <div class="question-box" id="question-text">
                SavybÄ—s tekstas bus Äia.
            </div>
        </div>

        <div class="flex flex-col space-y-4" id="options-container">
            <button class="option-btn btn-mejoze" data-type="Mejoze">MejozÄ—</button>
            <button class="option-btn btn-mitoze" data-type="Mitoze">MitozÄ—</button>
        </div>

        <div class="mt-8 text-center">
            <div id="feedback-message" class="text-xl font-bold min-h-[30px] mb-4"></div>
            <button id="action-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-xl transition-colors">
                Patikrinti
            </button>
        </div>
    </div>

    <div class="card hidden mt-6" id="results-card">
        <h2 class="text-2xl font-bold text-center text-blue-700 mb-4">
            ğŸ‰ Rezultatai
        </h2>
        <p class="text-center text-xl font-semibold mb-6">
            Teisingai atsakyta: <span id="final-score" class="text-green-600"></span>
        </p>
        <div id="result-details" class="space-y-3 max-h-60 overflow-y-auto p-2 border rounded-md">
            </div>
        <button onclick="location.reload()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg text-lg mt-6">
            PradÄ—ti iÅ¡ naujo
        </button>
    </div>

</div>

<script>
    // GOOGLE SHEETS URL IR DUOMENYS
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbzhXP3hJ6NBLOld6Gbg-tlN-Tk8BPoxx32tx9j-iKCJChVyeOpZiDyGu9g2cm6Vl0uf/exec';
    const TASK_ID = 'B0001 MejozÄ— vs MitozÄ— | Klasifikacija';

    const DATA = [
        { savybe: "Susidaro lytinÄ—s lÄ…stelÄ—s.", tipas: "Mejoze" },
        { savybe: "Susidaro kÅ«no lÄ…stelÄ—s.", tipas: "Mitoze" },
        { savybe: "IÅ¡ vienos motininÄ—s lÄ…stelÄ—s susidaro keturios dukterinÄ—s lÄ…stelÄ—s.", tipas: "Mejoze" },
        { savybe: "IÅ¡ vienos motininÄ—s lÄ…stelÄ—s susidaro dvi dukterinÄ—s lÄ…stelÄ—s.", tipas: "Mitoze" },
        { savybe: "Susidariusios lÄ…stelÄ—s yra skirtingos.", tipas: "Mejoze" },
        { savybe: "Susidariusios lÄ…stelÄ—s yra genetiÅ¡kai identiÅ¡kos.", tipas: "Mitoze" },
        { savybe: "SusidariusiÅ³ lÄ…steliÅ³ branduoliai turi skirtingÄ… paveldimÄ…jÄ… informacijÄ….", tipas: "Mejoze" },
        { savybe: "SusidariusiÅ³ lÄ…steliÅ³ branduoliai turi vienodÄ… paveldimÄ…jÄ… informacijÄ….", tipas: "Mitoze" },
        { savybe: "Branduolys dalijasi du kartus iÅ¡ eilÄ—s.", tipas: "Mejoze" },
        { savybe: "Branduolys dalijasi vienÄ… kartÄ….", tipas: "Mitoze" },
        { savybe: "Vyksta subrendusiame organizme.", tipas: "Mejoze" },
        { savybe: "Vyksta Ä¯vairaus amÅ¾iaus organizmuose.", tipas: "Mitoze" }
    ];
    const totalQuestions = DATA.length;
    
    // ELEMENTAI
    const memoCard = document.getElementById('memo-card');
    const testCard = document.getElementById('test-card');
    const resultsCard = document.getElementById('results-card');
    const startTestBtn = document.getElementById('start-test-btn');
    const questionTextEl = document.getElementById('question-text');
    const questionCountEl = document.getElementById('question-count');
    const actionBtn = document.getElementById('action-btn');
    const feedbackMessageEl = document.getElementById('feedback-message');
    const finalScoreEl = document.getElementById('final-score');
    const resultDetailsEl = document.getElementById('result-details');
    const studentNameDisplay = document.getElementById('studentNameDisplay');
    
    // BÅªSENA
    let currentQuestions = []; 
    let currentQuestionIndex = 0;
    let score = 0;
    let isAnswerChecked = false;
    let selectedAnswer = null;
    let userAnswersLog = [];

    // PAGALBINÄ–S FUNKCIJOS
    
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function sendResultToSheet(taskName, score) {
        const studentName = localStorage.getItem('studentName') || 'NeÅ¾inomas';
        const timestamp = new Date().toLocaleString('lt-LT');
        
        const data = {
            name: studentName,
            task: taskName,
            score: score,
            timestamp: timestamp
        };
        
        fetch(SHEET_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(() => {
            console.log('Rezultatas sÄ—kmingai iÅ¡siÅ³stas Ä¯ Google Sheets! âœ…');
        })
        .catch(error => {
            console.error('Klaida siunÄiant rezultatÄ…:', error);
        });
    }
    
    function showNamePrompt() {
        let studentName = localStorage.getItem('studentName');
        
        if (!studentName) {
            let name = prompt('Ä®veskite savo vardÄ…:');
            if (name && name.trim() !== '') {
                localStorage.setItem('studentName', name.trim());
                studentName = name.trim();
            } else {
                alert('PraÅ¡ome Ä¯vesti vardÄ…, kad galÄ—tumÄ—te pradÄ—ti uÅ¾duotÄ¯.');
                return showNamePrompt();
            }
        }
        studentNameDisplay.textContent = studentName;
        return studentName;
    }

    function changeName() {
        localStorage.removeItem('studentName');
        showNamePrompt();
        location.reload();
    }

    // TESTO LOGIKA
    
    function initializeTest() {
        showNamePrompt();
        startTestBtn.addEventListener('click', () => {
            memoCard.classList.remove('active');
            testCard.classList.add('active');
            currentQuestions = shuffleArray([...DATA]); 
            currentQuestionIndex = 0;
            score = 0;
            userAnswersLog = [];
            showQuestion();
        });
        
        // Nustatome pradines korteles bÅ«senas
        testCard.classList.remove('active');
        memoCard.classList.add('active'); 
    }

    function showQuestion() {
        if (currentQuestionIndex >= currentQuestions.length) {
            showResults();
            return;
        }

        const question = currentQuestions[currentQuestionIndex];
        
        questionCountEl.textContent = `Klausimas ${currentQuestionIndex + 1} iÅ¡ ${totalQuestions}`;
        questionTextEl.textContent = question.savybe;
        feedbackMessageEl.textContent = '';
        actionBtn.textContent = 'Patikrinti';
        actionBtn.onclick = checkAnswer;

        isAnswerChecked = false;
        selectedAnswer = null;

        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.remove('correct', 'incorrect', 'disabled', 'selected-border');
            btn.onclick = handleOptionClick;
        });
    }

    function handleOptionClick(event) {
        if (isAnswerChecked) return;
        
        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.remove('selected-border');
        });

        event.target.classList.add('selected-border');
        selectedAnswer = event.target.dataset.type;
    }

    function checkAnswer() {
        if (!selectedAnswer) {
            feedbackMessageEl.innerHTML = '<span class="text-red-500">âŒ Pasirinkite atsakymÄ…!</span>';
            return;
        }

        isAnswerChecked = true;
        const currentQuestion = currentQuestions[currentQuestionIndex];
        const correctType = currentQuestion.tipas;
        const isCorrect = selectedAnswer === correctType;

        userAnswersLog.push({
            savybe: currentQuestion.savybe,
            pasirinkimas: selectedAnswer,
            teisingas: correctType,
            isCorrect: isCorrect
        });

        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.add('disabled');
            btn.classList.remove('selected-border');

            if (btn.dataset.type === correctType) {
                btn.classList.add('correct');
            } else if (btn.dataset.type === selectedAnswer) {
                btn.classList.add('incorrect');
            }
        });

        if (isCorrect) {
            score++;
            feedbackMessageEl.innerHTML = '<span class="text-green-600">âœ… Teisingai!</span>';
        } else {
            feedbackMessageEl.innerHTML = '<span class="text-red-500">âŒ Neteisingai. Teisingas atsakymas paÅ¾ymÄ—tas Å¾alia spalva.</span>';
        }

        actionBtn.textContent = (currentQuestionIndex < totalQuestions - 1) ? 'Toliau' : 'Rezultatai';
        actionBtn.onclick = nextQuestion;
    }

    function nextQuestion() {
        currentQuestionIndex++;
        selectedAnswer = null;
        showQuestion();
    }

    function showResults() {
        testCard.classList.remove('active');
        resultsCard.classList.add('active');

        const percentage = Math.round((score / totalQuestions) * 100);
        finalScoreEl.textContent = `${score} iÅ¡ ${totalQuestions} (${percentage}%)`;
        finalScoreEl.classList.add(percentage >= 70 ? 'text-green-600' : 'text-red-600');

        let detailsHTML = '';
        userAnswersLog.forEach((answer, index) => {
            const status = answer.isCorrect ? 'Teisingai' : 'Neteisingai';
            const statusClass = answer.isCorrect ? 'text-green-700' : 'text-red-700';

            detailsHTML += `
                <div class="p-3 rounded-md border ${answer.isCorrect ? 'border-green-300 bg-green-50' : 'border-red-300 bg-red-50'}">
                    <p class="font-bold text-gray-800">${index + 1}. ${answer.savybe}</p>
                    <p class="${statusClass} font-semibold mt-1">
                        Atsakymas: ${answer.teisingas} (${status})
                    </p>
                </div>
            `;
        });

        resultDetailsEl.innerHTML = detailsHTML;
        
        sendResultToSheet(TASK_ID, percentage);
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // Kad funkcija bÅ«tÅ³ pasiekiama iÅ¡ HTML mygtuko
    window.changeName = changeName;

    // Pradinis paleidimas
    initializeTest();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒÆtvirtinkime veiksma≈æod≈æio nuosakas</title>
    <style>
        body {
            font-family: 'OpenDyslexic', Arial, sans-serif;
            letter-spacing: 0.05em;
            background: linear-gradient(135deg, #FFF9E6 0%, #FFFAEB 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .page-wrapper {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
            background-color: #7CB3E9;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 16px;
            transition: background-color 0.3s;
            white-space: nowrap;
        }
        
        .back-btn:hover {
            background-color: #4A90E2;
        }
        
        .student-info {
            background-color: #ffffff;
            padding: 10px 18px;
            border-radius: 10px;
            border: 2px solid #4A90E2;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            flex-grow: 1;
        }
        
        .change-name-btn {
            background-color: #4A90E2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'OpenDyslexic', Arial, sans-serif;
            font-size: 14px;
            transition: background-color 0.3s;
            white-space: nowrap;
        }
        
        .change-name-btn:hover {
            background-color: #0D3B66;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border: 3px solid #4A90E2;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
        }

        .header h1 {
            color: #0D3B66;
            margin-bottom: 15px;
            font-size: 2rem;
        }

        .instructions {
            background: #E8F4F8;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #7CB3E9;
            font-size: 1.1rem;
            color: #1A4D7A;
        }

        .instructions strong {
            color: #0D3B66;
        }

        .example {
            font-style: italic;
            margin-top: 10px;
            color: #4A90E2;
        }

        .game-area {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin: 25px 0;
        }

        .table-container {
            background: #ffffff;
            border-radius: 12px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, #4A90E2, #0D3B66);
            color: white;
            padding: 15px;
            font-size: 1.2rem;
            text-align: center;
            border: 2px solid #0D3B66;
        }

        td {
            padding: 12px;
            text-align: center;
            border: 2px solid #B8D4E8;
            min-height: 60px;
            vertical-align: middle;
        }

        .verb-label {
            font-weight: bold;
            color: #0D3B66;
            background: #E8F4F8;
            font-size: 1.1rem;
        }

        .drop-zone {
            min-height: 50px;
            background-color: #F8FBFD;
            border: 2px dashed #B8D4E8;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
            padding: 8px;
        }

        .drop-zone.hovered {
            background-color: #E3F2FD;
            border-color: #4A90E2;
            border-style: solid;
        }

        .drop-zone.filled {
            background-color: #ffffff;
            border-style: solid;
        }

        .drop-zone.correct {
            background-color: #d4edda;
            border-color: #27ae60;
        }

        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #e74c3c;
        }

        .words-pool {
            background: #E8F4F8;
            border-radius: 12px;
            padding: 20px;
            border: 3px solid #7CB3E9;
        }

        .words-pool h3 {
            text-align: center;
            color: #0D3B66;
            margin: 0 0 20px 0;
            font-size: 1.3rem;
        }

        .words-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .draggable-word {
            background: white;
            border: 3px solid #4A90E2;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #0D3B66;
            cursor: grab;
            transition: all 0.3s;
            user-select: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .draggable-word:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .draggable-word:active {
            cursor: grabbing;
            transform: scale(0.98);
        }

        .draggable-word.in-zone {
            cursor: default;
            border: none;
            box-shadow: none;
            background: transparent;
            padding: 4px;
        }

        .controls {
            text-align: center;
            margin: 30px 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, #4A90E2, #0D3B66);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'OpenDyslexic', Arial, sans-serif;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(74, 144, 226, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn.reset {
            background: linear-gradient(45deg, #FFB84D, #FF9800);
        }

        .results {
            background: #E8F4F8;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            display: none;
            border: 3px solid #4A90E2;
            margin-top: 20px;
        }

        .results.show {
            display: block;
        }

        .results h2 {
            color: #0D3B66;
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .results .final-score {
            font-size: 2.5rem;
            color: #1A4D7A;
            margin: 20px 0;
        }

        .results .encouragement {
            font-size: 1.3rem;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
        }

        @media (max-width: 900px) {
            .game-area {
                grid-template-columns: 1fr;
            }

            th, td {
                padding: 10px;
                font-size: 0.95rem;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="header-container">
            <a href="../../index.html" class="back-btn">‚Üê GrƒØ≈æti ƒØ prad≈æiƒÖ</a>
            <div class="student-info">
                <span style="font-size: 16px; color: #1A4D7A;">
                    Mokinys: <strong id="studentNameDisplay"></strong>
                </span>
                <button class="change-name-btn" onclick="changeName()">Keisti vardƒÖ</button>
            </div>
        </div>

        <div class="container">
            <div class="header">
                <h1>üìù ƒÆtvirtinkime veiksma≈æod≈æio nuosakas</h1>
            </div>

            <div class="instructions">
                <strong>Pagal pavyzdƒØ para≈°ykite pateikt≈≥ veiksma≈æod≈æi≈≥ tariamosios nuosakos treƒçiƒÖjƒØ asmenƒØ ir liepiamosios nuosakos daugiskaitos pirmƒÖjƒØ asmenƒØ.</strong>
                <div class="example">Pavyzdys: Mesti ‚Äì mest≈≥, meskime.</div>
            </div>

            <div class="game-area">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Veiksma≈æodis</th>
                                <th>Tariamoji nuosaka<br>(3 asm.)</th>
                                <th>Liepiamoji nuosaka<br>(1 asm. dgs.)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="verb-label">Grau≈æti</td>
                                <td><div class="drop-zone" data-verb="grau≈æti" data-form="tariamoji"></div></td>
                                <td><div class="drop-zone" data-verb="grau≈æti" data-form="liepiamoji"></div></td>
                            </tr>
                            <tr>
                                <td class="verb-label">Pir≈°ti</td>
                                <td><div class="drop-zone" data-verb="pir≈°ti" data-form="tariamoji"></div></td>
                                <td><div class="drop-zone" data-verb="pir≈°ti" data-form="liepiamoji"></div></td>
                            </tr>
                            <tr>
                                <td class="verb-label">Atsigre≈æti</td>
                                <td><div class="drop-zone" data-verb="atsigre≈æti" data-form="tariamoji"></div></td>
                                <td><div class="drop-zone" data-verb="atsigre≈æti" data-form="liepiamoji"></div></td>
                            </tr>
                            <tr>
                                <td class="verb-label">Matyti</td>
                                <td><div class="drop-zone" data-verb="matyti" data-form="tariamoji"></div></td>
                                <td><div class="drop-zone" data-verb="matyti" data-form="liepiamoji"></div></td>
                            </tr>
                            <tr>
                                <td class="verb-label">Degti</td>
                                <td><div class="drop-zone" data-verb="degti" data-form="tariamoji"></div></td>
                                <td><div class="drop-zone" data-verb="degti" data-form="liepiamoji"></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="words-pool">
                    <h3>üéØ ≈Ωod≈æiai</h3>
                    <div class="words-container" id="wordsContainer"></div>
                </div>
            </div>

            <div class="controls">
                <button class="btn" onclick="checkAnswers()" id="checkBtn">‚úÖ Patikrinti atsakymus</button>
                <button class="btn reset" onclick="resetGame()" id="resetBtn">üîÑ Pradƒóti i≈° naujo</button>
            </div>

            <div class="results" id="results">
                <h2>üéâ U≈æduotis baigta!</h2>
                <div id="finalScoreContainer"></div>
                <div id="encouragementContainer"></div>
            </div>
        </div>
    </div>

<script>
// --- Vard≈≥ valdymas ---
function showNamePrompt() {
    const studentName = localStorage.getItem('studentName');
    if (!studentName) {
        const name = prompt('ƒÆvesk savo vardƒÖ:');
        if (name && name.trim() !== '') {
            localStorage.setItem('studentName', name.trim());
            return name.trim();
        } else {
            alert('Pra≈°ome ƒØvesti vardƒÖ, kad galƒótumƒóte pradƒóti u≈æduotƒØ.');
            return showNamePrompt();
        }
    }
    return studentName;
}

function changeName() {
    localStorage.removeItem('studentName');
    const newName = showNamePrompt();
    alert(`Vardas pakeistas ƒØ: ${newName}`);
    location.reload();
}

function sendResultToSheet(taskName, score) {
    const studentName = localStorage.getItem('studentName') || 'Ne≈æinomas';
    const timestamp = new Date().toLocaleString('lt-LT');

    const data = {
        name: studentName,
        task: taskName,
        score: score,
        timestamp: timestamp
    };

    console.log('Siunƒçiamas rezultatas:', data);

    fetch('https://script.google.com/macros/s/AKfycbzhXP3hJ6NBLOld6Gbg-tlN-Tk8BPoxx32tx9j-iKCJChVyeOpZiDyGu9g2cm6Vl0uf/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(() => {
        console.log('Rezultatas sƒókmingai i≈°si≈≥stas ƒØ Google Sheets! ‚úÖ');
    })
    .catch(error => {
        console.error('Klaida siunƒçiant rezultatƒÖ:', error);
    });
}

const studentName = showNamePrompt();
document.getElementById('studentNameDisplay').textContent = studentName;

// --- Teisingi atsakymai ---
const correctAnswers = {
    'grau≈æti-tariamoji': 'grau≈æt≈≥',
    'grau≈æti-liepiamoji': 'grau≈°kime',
    'pir≈°ti-tariamoji': 'pir≈°t≈≥',
    'pir≈°ti-liepiamoji': 'pir≈°ime',
    'atsigre≈æti-tariamoji': 'atsigre≈æt≈≥',
    'atsigre≈æti-liepiamoji': 'atsigrƒó≈ækime',
    'matyti-tariamoji': 'matyt≈≥',
    'matyti-liepiamoji': 'matykime',
    'degti-tariamoji': 'degt≈≥',
    'degti-liepiamoji': 'degkime'
};

// --- ≈Ωod≈æi≈≥ sƒÖra≈°as (sumai≈°ytas) ---
const words = [
    'grau≈°t≈≥', 'grau≈°kime',
    'pir≈°t≈≥', 'pir≈°ime',
    'atsigre≈æt≈≥', 'atsigrƒó≈ækime',
    'matyt≈≥', 'matykime',
    'degt≈≥', 'degkime'
];

let draggedElement = null;
let checkedAnswers = false;

// Touch drag kintamieji
let touchedElement = null;
let clone = null;

// --- Inicializacija ---
function initGame() {
    const container = document.getElementById('wordsContainer');
    container.innerHTML = '';
    
    // Sumai≈°ome ≈æod≈æius
    const shuffled = [...words].sort(() => Math.random() - 0.5);
    
    shuffled.forEach((word, i) => {
        const wordEl = document.createElement('div');
        wordEl.className = 'draggable-word';
        wordEl.textContent = word;
        wordEl.draggable = true;
        wordEl.id = `word-${i}`;
        container.appendChild(wordEl);
    });
    
    addDragListeners();
}

// --- Drag & Drop ---
function addDragListeners() {
    const draggables = document.querySelectorAll('.draggable-word');
    const dropZones = document.querySelectorAll('.drop-zone');
    
    draggables.forEach(draggable => {
        draggable.addEventListener('dragstart', e => {
            if (!draggable.classList.contains('in-zone')) {
                draggedElement = e.target;
                e.dataTransfer.effectAllowed = 'move';
            }
        });
        
        draggable.addEventListener('dragend', e => {
            draggedElement = null;
        });
        
        // Touch events
        draggable.addEventListener('touchstart', handleTouchStart, {passive: false});
        draggable.addEventListener('touchmove', handleTouchMove, {passive: false});
        draggable.addEventListener('touchend', handleTouchEnd, {passive: false});
    });
    
    dropZones.forEach(zone => {
        zone.addEventListener('dragover', e => {
            e.preventDefault();
            zone.classList.add('hovered');
        });
        
        zone.addEventListener('dragleave', e => {
            zone.classList.remove('hovered');
        });
        
        zone.addEventListener('drop', e => {
            e.preventDefault();
            zone.classList.remove('hovered');
            
            if (draggedElement && !draggedElement.classList.contains('in-zone')) {
                // Jei zonoje jau yra ≈æodis, grƒÖ≈æiname jƒØ atgal
                const existingWord = zone.querySelector('.draggable-word');
                if (existingWord) {
                    existingWord.classList.remove('in-zone');
                    document.getElementById('wordsContainer').appendChild(existingWord);
                }
                
                zone.appendChild(draggedElement);
                draggedElement.classList.add('in-zone');
                zone.classList.add('filled');
            }
        });
    });
}

// --- Touch handlers ---
function handleTouchStart(e) {
    if (e.target.classList.contains('in-zone')) return;
    
    e.preventDefault();
    touchedElement = e.target;
    const touch = e.touches[0];
    
    clone = touchedElement.cloneNode(true);
    clone.style.position = 'fixed';
    clone.style.pointerEvents = 'none';
    clone.style.opacity = '0.8';
    clone.style.zIndex = '1000';
    clone.style.left = touch.clientX - touchedElement.offsetWidth / 2 + 'px';
    clone.style.top = touch.clientY - touchedElement.offsetHeight / 2 + 'px';
    clone.style.width = touchedElement.offsetWidth + 'px';
    document.body.appendChild(clone);
    
    touchedElement.style.opacity = '0.3';
}

function handleTouchMove(e) {
    if (!clone) return;
    e.preventDefault();
    const touch = e.touches[0];
    clone.style.left = touch.clientX - clone.offsetWidth / 2 + 'px';
    clone.style.top = touch.clientY - clone.offsetHeight / 2 + 'px';
    
    const dropZones = document.querySelectorAll('.drop-zone');
    dropZones.forEach(zone => {
        const rect = zone.getBoundingClientRect();
        if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
            touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
            zone.classList.add('hovered');
        } else {
            zone.classList.remove('hovered');
        }
    });
}

function handleTouchEnd(e) {
    if (!touchedElement) return;
    e.preventDefault();
    
    const touch = e.changedTouches[0];
    const dropZones = document.querySelectorAll('.drop-zone');
    let dropped = false;
    
    dropZones.forEach(zone => {
        const rect = zone.getBoundingClientRect();
        if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
            touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
            
            const existingWord = zone.querySelector('.draggable-word');
            if (existingWord) {
                existingWord.classList.remove('in-zone');
                document.getElementById('wordsContainer').appendChild(existingWord);
            }
            
            zone.appendChild(touchedElement);
            touchedElement.classList.add('in-zone');
            zone.classList.add('filled');
            zone.classList.remove('hovered');
            dropped = true;
        }
    });
    
    touchedElement.style.opacity = '1';
    if (clone) {
        document.body.removeChild(clone);
        clone = null;
    }
    touchedElement = null;
    dropZones.forEach(zone => zone.classList.remove('hovered'));
}

// --- Patikrinimas ---
function checkAnswers() {
    if (checkedAnswers) return;
    
    let correctCount = 0;
    const totalQuestions = Object.keys(correctAnswers).length;
    
    const dropZones = document.querySelectorAll('.drop-zone');
    dropZones.forEach(zone => {
        const verb = zone.dataset.verb;
        const form = zone.dataset.form;
        const key = `${verb}-${form}`;
        const correctAnswer = correctAnswers[key];
        
        const word = zone.querySelector('.draggable-word');
        if (word && word.textContent === correctAnswer) {
            zone.classList.add('correct');
            correctCount++;
        } else {
            zone.classList.add('incorrect');
        }
    });
    
    checkedAnswers = true;
    showResults(correctCount, totalQuestions);
    document.getElementById('checkBtn').disabled = true;
}

// --- Rezultatai ---
function showResults(correctCount, totalQuestions) {
    const percentage = Math.round((correctCount / totalQuestions) * 100);
    const resultsDiv = document.getElementById('results');
    const finalScore = document.getElementById('finalScoreContainer');
    const encouragement = document.getElementById('encouragementContainer');
    
    finalScore.innerHTML = `
        <div style="font-size: 3rem; margin-bottom: 20px;">üéØ</div>
        <div class="final-score">
            ${correctCount}/${totalQuestions} (${percentage}%)
        </div>
    `;
    
    let encouragementText = '';
    let encouragementColor = '';
    
    if (percentage === 100) {
        encouragementText = 'üåü Tobula! Tu puikiai i≈°mokai veiksma≈æod≈æi≈≥ nuosakas!';
        encouragementColor = '#27ae60';
    } else if (percentage >= 80) {
        encouragementText = 'üëç Labai gerai! Beveik viskas teisingai!';
        encouragementColor = '#2ecc71';
    } else if (percentage >= 60) {
        encouragementText = 'üòä Gerai! Dar truputƒØ patreniruok ir bus tobulai!';
        encouragementColor = '#3498db';
    } else {
        encouragementText = 'üí™ Pakartok nuosak≈≥ taisykles ir bandyk dar kartƒÖ!';
        encouragementColor = '#f39c12';
    }
    
    encouragement.innerHTML = `
        <div class="encouragement" style="background-color: ${encouragementColor}20; border: 3px solid ${encouragementColor}; color: ${encouragementColor};">
            ${encouragementText}
        </div>
    `;
    
    resultsDiv.classList.add('show');
    sendResultToSheet('L0601 Veiksma≈æod≈æio nuosakos - drag & drop', percentage);
}

// --- Reset ---
function resetGame() {
    document.querySelectorAll('.drop-zone').forEach(zone => {
        const word = zone.querySelector('.draggable-word');
        if (word) {
            word.classList.remove('in-zone');
            document.getElementById('wordsContainer').appendChild(word);
        }
        zone.classList.remove('filled', 'correct', 'incorrect');
    });
    
    checkedAnswers = false;
    document.getElementById('checkBtn').disabled = false;
    document.getElementById('results').classList.remove('show');
    
    initGame();
}

// --- Paleidimas ---
initGame();
</script>
</body>
</html>

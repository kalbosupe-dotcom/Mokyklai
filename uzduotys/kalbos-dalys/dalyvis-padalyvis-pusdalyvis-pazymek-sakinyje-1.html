<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dalyvis, Pusdalyvis, Padalyvis - Teksto Analizƒó</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'OpenDyslexic', Arial, sans-serif;
            letter-spacing: 0.05em;
            background-color: #e3f2fd;
            line-height: 1.8;
            min-height: 100vh;
            padding: 20px;
        }

        .page-wrapper {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        /* Vir≈°utinis info blokas */
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            padding: 12px 24px;
            background-color: #93c5fd;
            color: #1e3a8a;
            text-decoration: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid #1976d2;
            white-space: nowrap;
        }
        
        .student-info {
            background-color: #ffffff;
            padding: 12px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            flex-grow: 1;
            font-size: 18px;
            border: 2px solid #1976d2;
        }
        
        .change-name-btn {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        /* Kortelƒós stiliai */
        .card {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            padding: 20px;
            display: none;
            border: 3px solid #1976d2;
        }
        
        .card.active {
            display: block;
            animation: fadeIn 0.4s ease-in;
        }
        
        .question-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 10px;
        }
        .question-title strong {
             font-weight: 900;
        }

        /* Instrukcijos */
        .instructions {
            background-color: #f9fafb;
            border: 3px solid #e5e7eb;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            line-height: 1.8;
            color: #1f2937;
        }

        .instructions ol {
            margin-left: 0;
            padding-left: 0;
            list-style-type: none;
            counter-reset: custom-counter;
        }

        .instructions li {
            counter-increment: custom-counter;
            margin-bottom: 10px;
            font-weight: 500;
            padding-left: 30px;
            position: relative;
        }

        .instructions li::before {
            content: counter(custom-counter) ".";
            font-weight: 900;
            color: #1976d2;
            position: absolute;
            left: 0;
        }
        .instructions strong {
             font-weight: 900;
             color: #1f2937;
        }

        /* PATAISYMAS: Spalv≈≥ pasirinkimo paletƒó */
        .color-palette {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .color-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 3px solid transparent; /* Pradinƒó siena */
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background-color: #f9fafb;
        }

        .color-option:hover {
             transform: translateY(-2px);
        }

        /* VIZUALINIS PATVIRTINIMAS */
        .color-option.selected {
            border-color: #1976d2; /* Ry≈°kus mƒólynas rƒómelis aktyviam pasirinkimui */
            box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4);
            transform: scale(1.05);
        }

        .btn-dalyvis { background-color: #a4d49d; color: #27541f; }
        .btn-pusdalyvis { background-color: #f2e796; color: #9e8f1c; }
        .btn-padalyvis { background-color: #c6d9f7; color: #2d4c7d; }
        .icon-book { font-size: 1.5rem; margin-bottom: 5px; }

        /* Sakinio rƒómelis */
        .sentence-container {
            background-color: #deeffa;
            border: 3px solid #7cb3e9;
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
            font-size: 1.7rem;
            line-height: 2;
            text-align: center;
        }

        .word {
            display: inline-block;
            padding: 5px 10px;
            margin: 0 3px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .word:hover {
            border-color: #1976d2;
        }

        /* VIZUALINIS PATVIRTINIMAS: Aktyviai pa≈æymƒótas ≈æodis */
        .word.highlighted-Dalyvis { background-color: #a4d49d; border-color: #27541f; font-weight: 700; }
        .word.highlighted-Pusdalyvis { background-color: #f2e796; border-color: #9e8f1c; font-weight: 700; }
        .word.highlighted-Padalyvis { background-color: #c6d9f7; border-color: #2d4c7d; font-weight: 700; }
        
        .word.correct-answer { background-color: #a4d49d !important; border-color: #27541f !important; }
        .word.wrong-answer { background-color: #fee2e2 !important; border-color: #ef4444 !important; }

        /* Mygtukai */
        .action-button {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            color: white;
            max-width: 400px; margin: 20px auto 0; padding: 16px 32px; font-size: 1.2rem; font-weight: 700; border-radius: 12px; border: none; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: block;
        }
        /* ... (kiti stiliai) ... */
        
        /* Mobilusis dizainas */
        @media (max-width: 768px) {
            .sentence-container { font-size: 1.2rem; padding: 20px; }
            .question-title { font-size: 1.5rem; }
            .header-container { flex-direction: column; align-items: stretch; }
            .student-info { width: 100%; }
            .action-button { max-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        
        <div class="header-container">
            <a href="/Mokyklai/" class="back-btn">‚Üê GrƒØ≈æti ƒØ prad≈æiƒÖ</a>
            
            <div class="student-info">
                <span>Mokinys: <strong id="studentNameDisplay"></strong></span>
                <button class="change-name-btn" onclick="changeName()">Keisti vardƒÖ</button>
            </div>
        </div>

        <div id="task-cards-container"></div>

        <div id="card-results" class="card">
            <h2 class="question-title">üéâ Testo rezultatai</h2>
            <div class="result-container">
                <div class="total-score" id="total-score"></div>
                <div class="result-details" id="result-details"></div>
            </div>
            <button onclick="location.reload()" class="action-button bg-green-600">üîÑ Pradƒóti i≈° naujo</button>
        </div>
    </div>

<script>
    // --- KONFIGURACIJA ---
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbzhXP3hJ6NBLOld6Gbg-tlN-Tk8BPoxx32tx9j-iKCJChVyeOpZiDyGu9g2cm6Vl0uf/exec';
    const TASK_ID = 'L0051 Dalyvis, Pusdalyvis, Padalyvis - Teksto Analizƒó | 10 sakini≈≥';
    const totalQuestions = 10;
    
    // --- SAKINI≈≤ DUOMENYS (10 sakini≈≥) ---
    const SENTENCES_DATA = [
        { sentence: "Pavargƒôs berniukas grƒØ≈æo namo.", words: ["Pavargƒôs", "berniukas", "grƒØ≈æo", "namo."], correctWord: "Pavargƒôs", correctType: "Dalyvis" },
        { sentence: "Eidamas ƒØ mokyklƒÖ sutikau draugƒÖ.", words: ["Eidamas", "ƒØ", "mokyklƒÖ", "sutikau", "draugƒÖ."], correctWord: "Eidamas", correctType: "Pusdalyvis" },
        { sentence: "Saulei ≈°vieƒçiant vaikai ≈æaidƒó lauke.", words: ["Saulei", "≈°vieƒçiant", "vaikai", "≈æaidƒó", "lauke."], correctWord: "≈°vieƒçiant", correctType: "Padalyvis" },
        { sentence: "Skaitanti mergaitƒó sƒódƒójo ant suolelio.", words: ["Skaitanti", "mergaitƒó", "sƒódƒójo", "ant", "suolelio."], correctWord: "Skaitanti", correctType: "Dalyvis" },
        { sentence: "Kalbƒódamas telefonu jis vaik≈°ƒçiojo po kambarƒØ.", words: ["Kalbƒódamas", "telefonu", "jis", "vaik≈°ƒçiojo", "po", "kambarƒØ."], correctWord: "Kalbƒódamas", correctType: "Pusdalyvis" },
        { sentence: "Lietui lyjant mes pasilikome namuose.", words: ["Lietui", "lyjant", "mes", "pasilikome", "namuose."], correctWord: "lyjant", correctType: "Padalyvis" },
        { sentence: "Para≈°ytas lai≈°kas gulƒójo ant stalo.", words: ["Para≈°ytas", "lai≈°kas", "gulƒójo", "ant", "stalo."], correctWord: "Para≈°ytas", correctType: "Dalyvis" },
        { sentence: "≈Ωi≈´rƒódami filmƒÖ valgƒóme spragƒósius.", words: ["≈Ωi≈´rƒódami", "filmƒÖ", "valgƒóme", "spragƒósius."], correctWord: "≈Ωi≈´rƒódami", correctType: "Pusdalyvis" },
        { sentence: "Jam atƒójus visi nutilo.", words: ["Jam", "atƒójus", "visi", "nutilo."], correctWord: "atƒójus", correctType: "Padalyvis" },
        { sentence: "Bƒógantis ≈°uo vijosi katƒô.", words: ["Bƒógantis", "≈°uo", "vijosi", "katƒô."], correctWord: "Bƒógantis", correctType: "Dalyvis" }
    ];
    
    // --- B≈™SENA ---
    let questionStates = {};
    let score = 0;
    let userAnswersLog = [];
    
    // --- VARD≈≤ VALDYMAS ---
    function showNamePrompt() {
        const studentName = localStorage.getItem('studentName');
        if (!studentName) {
            const name = prompt('ƒÆvesk savo vardƒÖ:');
            if (name && name.trim() !== '') {
                localStorage.setItem('studentName', name.trim());
                return name.trim();
            } else {
                alert('‚ùó Pra≈°ome ƒØvesti vardƒÖ, kad galƒótumƒóte pradƒóti u≈æduotƒØ.');
                return showNamePrompt();
            }
        }
        return studentName;
    }

    function changeName() {
        localStorage.removeItem('studentName');
        showNamePrompt();
        location.reload();
    }

    function sendResultToSheet(taskName, score) {
        const studentName = localStorage.getItem('studentName') || 'Ne≈æinomas';
        const timestamp = new Date().toLocaleString('lt-LT');
        const data = {
            name: studentName,
            task: taskName,
            score: score,
            timestamp: timestamp
        };
        fetch(SHEET_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        }).then(() => console.log('Rezultatas sƒókmingai i≈°si≈≥stas!'))
          .catch(error => console.error('Klaida siunƒçiant rezultatƒÖ:', error));
    }

    // --- SPALVOS PASIRINKIMAS ---
    function selectColor(colorType, questionNum, event) {
        const state = questionStates[questionNum];
        if (state.isChecked) return;
        
        state.selectedColor = colorType;
        
        // Pa≈°alinti selected klasƒô nuo vis≈≥ spalv≈≥
        const colorOptions = document.querySelectorAll(`#card-task-${questionNum} .color-option`);
        colorOptions.forEach(opt => {
            opt.classList.remove('selected');
        });
        
        // Pridƒóti selected klasƒô tik paspaustai spalvai (VIZUALINIS PATVIRTINIMAS 1)
        event.currentTarget.classList.add('selected');
    }

    // --- ≈ΩOD≈ΩIO PA≈ΩYMƒñJIMAS ---
    function highlightWord(wordElement, questionNum) {
        const state = questionStates[questionNum];
        if (state.isChecked) return;
        
        if (!state.selectedColor) {
            alert('‚ùó Pirmiausia pasirink spalvƒÖ!');
            return;
        }

        const sentenceContainer = document.getElementById(`sentence-${questionNum}`);
        const allWords = sentenceContainer.querySelectorAll('.word');
        
        // Pa≈°alinti pary≈°kinimƒÖ nuo vis≈≥ ≈æod≈æi≈≥
        allWords.forEach(w => {
            w.classList.remove('highlighted-Dalyvis', 'highlighted-Pusdalyvis', 'highlighted-Padalyvis');
        });
        
        // Pa≈æymƒóti pasirinktƒÖ ≈æodƒØ
        state.selectedWord = wordElement.textContent.replace(/[.,!?]/g, '');
        
        // Pa≈æymƒóti tik pasirinktƒÖ ≈æodƒØ pasirinkta spalva (VIZUALINIS PATVIRTINIMAS 2)
        wordElement.classList.add(`highlighted-${state.selectedColor}`);
    }

    // --- ATSAKYMO TIKRINIMAS ---
    function checkAnswer(questionNum) {
        const state = questionStates[questionNum];
        if (state.isChecked) return;
        
        const checkBtn = document.getElementById(`check-btn-${questionNum}`);
        
        if (!state.selectedWord || !state.selectedColor) {
            alert('‚ùó Pasirink spalvƒÖ ir pa≈æymƒók ≈æodƒØ!');
            return;
        }

        state.isChecked = true;
        
        const questionData = SENTENCES_DATA[questionNum - 1];
        const correctWord = questionData.correctWord;
        const correctType = questionData.correctType;
        
        // Tikrinimas: turi sutapti IR ≈ΩODIS, IR SPALVA
        const isCorrect = (state.selectedWord === correctWord && state.selectedColor === correctType);
        
        const feedbackEl = document.getElementById(`feedback-${questionNum}`);
        const sentenceContainer = document.getElementById(`sentence-${questionNum}`);
        const allWords = sentenceContainer.querySelectorAll('.word');
        
        // Rasti teisingƒÖ ≈æodƒØ ir pa≈æymƒóti
        allWords.forEach(w => {
            const wordText = w.textContent.replace(/[.,!?]/g, '');
            w.style.cursor = 'default';
            
            if (wordText === correctWord) {
                // Teisingas ≈æodis visada yra ≈æalios spalvos (correct-answer)
                w.classList.remove('highlighted-Dalyvis', 'highlighted-Pusdalyvis', 'highlighted-Padalyvis');
                w.classList.add('correct-answer');
            } else if (wordText === state.selectedWord) {
                // Pasirinktas, bet neteisingas ≈æodis (wrong-answer)
                if (wordText !== correctWord) {
                    w.classList.add('wrong-answer');
                }
            }
        });

        if (isCorrect) {
            score++;
            feedbackEl.innerHTML = `‚úÖ <strong>Teisingai!</strong> ≈Ωodis "<strong>${correctWord}</strong>" yra <strong>${correctType}</strong>.`;
            feedbackEl.className = 'feedback correct show';
        } else {
            feedbackEl.innerHTML = `‚ùå <strong>Neteisingai.</strong> Teisingas atsakymas: ≈æodis "<strong>${correctWord}</strong>" yra <strong>${correctType}</strong>.`;
            feedbackEl.className = 'feedback incorrect show';
        }

        // ƒÆra≈°yti atsakymƒÖ
        userAnswersLog.push({
            sentence: questionData.sentence,
            selectedWord: state.selectedWord,
            selectedType: state.selectedColor,
            correctWord: correctWord,
            correctType: correctType,
            isCorrect: isCorrect
        });

        checkBtn.style.display = 'none';

        const nextBtn = document.getElementById(`next-btn-${questionNum}`);
        nextBtn.style.display = 'block';
    }

    // --- KORTELI≈≤ GENERAVIMAS ---
    function generateTaskCards() {
        const container = document.getElementById('task-cards-container');
        
        SENTENCES_DATA.forEach((sentenceData, index) => {
            const questionNum = index + 1;
            const cardId = `card-task-${questionNum}`;
            
            // Inicializuoti b≈´senƒÖ
            questionStates[questionNum] = { selectedColor: null, selectedWord: null, isChecked: false };
            
            const cardDiv = document.createElement('div');
            cardDiv.id = cardId;
            cardDiv.className = 'card';
            
            const wordsHtml = sentenceData.words.map(word => 
                `<span class="word" onclick="highlightWord(this, ${questionNum})">${word}</span>`
            ).join(' ');

            const isLastQuestion = questionNum === totalQuestions;

            cardDiv.innerHTML = `
                <h2 class="question-title">Sakinys <strong>${questionNum}</strong> i≈° <strong>${totalQuestions}</strong></h2>

                <div class="instructions">
                    <ol>
                        <li>üìñ <strong>Perskaityk</strong> sakinƒØ.</li>
                        <li>üß† <strong>Nustatyk</strong>, kuris ≈æodis yra dalyvis, pusdalyvis ar padalyvis.</li>
                        <li>üé® <strong>Pasirink</strong> tinkamƒÖ spalvƒÖ.</li>
                        <li>üëÜ <strong>Spustelƒók</strong> ant ≈æod≈æio, kurƒØ nori pa≈æymƒóti.</li>
                        <li>‚úÖ Spausk "Pasitikrinti".</li>
                    </ol>
                </div>

                <div class="sentence-container" id="sentence-${questionNum}">
                    ${wordsHtml}
                </div>

                <div class="color-palette">
                    <div class="color-option btn-dalyvis" onclick="selectColor('Dalyvis', ${questionNum}, event)">
                        <span class="icon-book">üìó</span> Dalyvis<br>Koks? Kokia?
                    </div>
                    <div class="color-option btn-pusdalyvis" onclick="selectColor('Pusdalyvis', ${questionNum}, event)">
                        <span class="icon-book">üìô</span> Pusdalyvis<br>KƒÖ veikdamas?
                    </div>
                    <div class="color-option btn-padalyvis" onclick="selectColor('Padalyvis', ${questionNum}, event)">
                        <span class="icon-book">üìò</span> Padalyvis<br>Kaip? Kada?
                    </div>
                </div>

                <div id="feedback-${questionNum}" class="feedback"></div>

                <button id="check-btn-${questionNum}" onclick="checkAnswer(${questionNum})" class="action-button bg-blue-600">
                    ‚úÖ Pasitikrinti
                </button>

                <button id="next-btn-${questionNum}" onclick="nextQuestion(${questionNum})" class="action-button bg-blue-600" style="display: none;">
                    ${isLastQuestion ? 'üèÅ Rezultatai' : '‚û°Ô∏è Toliau'}
                </button>
            `;
            
            container.appendChild(cardDiv);
        });
    }

    // --- NAVIGACIJA ---
    function showCard(cardId) {
        document.querySelectorAll('.card').forEach(card => {
            card.classList.remove('active');
        });
        document.getElementById(cardId).classList.add('active');
        window.scrollTo(0, 0);
    }

    function nextQuestion(currentNum) {
        if (currentNum < totalQuestions) {
            showCard(`card-task-${currentNum + 1}`);
        } else {
            showResults();
        }
    }

    function showResults() {
        showCard('card-results');
        
        const totalScoreEl = document.getElementById('total-score');
        const resultDetailsEl = document.getElementById('result-details');
        
        const percentage = Math.round((score / totalQuestions) * 100);
        
        totalScoreEl.innerHTML = `
            <div>Teisingai atsakyta:</div>
            <div style="font-size: 3rem; margin: 20px 0;"><strong>${score}</strong> i≈° <strong>${totalQuestions}</strong></div>
            <div class="score-percentage">${percentage}%</div>
        `;
        
        // Detali suvestinƒó
        let detailsHTML = '';
        userAnswersLog.forEach((answer, index) => {
            const itemClass = answer.isCorrect ? 'correct' : 'incorrect';
            const icon = answer.isCorrect ? '‚úÖ' : '‚ùå';
            
            detailsHTML += `
                <div class="result-item ${itemClass}">
                    ${icon} <strong>Sakinys ${index + 1}:</strong> "${answer.sentence}"<br>
                    <span style="margin-left: 30px;">
                        Pasirinkta: <strong>${answer.selectedWord || '(nepasirinkta)'}</strong> (${answer.selectedType || ''}) 
                        ${!answer.isCorrect ? `| Teisinga: <strong>${answer.correctWord}</strong> (${answer.correctType})` : ''}
                    </span>
                </div>
            `;
        });
        resultDetailsEl.innerHTML = detailsHTML;
        
        // Siunƒçiame rezultatus
        sendResultToSheet(TASK_ID, percentage);
    }

    // --- INICIALIZACIJA ---
    window.onload = function() {
        const studentName = showNamePrompt();
        document.getElementById('studentNameDisplay').textContent = studentName;
        
        generateTaskCards();
        // Pradedame nuo pirmos u≈æduoties
        showCard('card-task-1');
    };
</script>
</body>
</html>

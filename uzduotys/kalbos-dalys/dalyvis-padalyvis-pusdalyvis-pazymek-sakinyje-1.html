<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dalyvis, Pusdalyvis, Padalyvis - Teksto AnalizÄ—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'OpenDyslexic', Arial, sans-serif;
            letter-spacing: 0.05em;
            background-color: #e3f2fd;
            line-height: 1.8;
            min-height: 100vh;
            padding: 20px;
        }

        .page-wrapper {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        /* VirÅ¡utinis info blokas */
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            padding: 12px 24px;
            background-color: #93c5fd;
            color: #1e3a8a;
            text-decoration: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid #1976d2;
            white-space: nowrap;
        }
        
        .student-info {
            background-color: #ffffff;
            padding: 12px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            flex-grow: 1;
            font-size: 18px;
            border: 2px solid #1976d2;
        }
        
        .change-name-btn {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        /* KortelÄ—s stiliai */
        .card {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            padding: 40px;
            display: none;
            border: 3px solid #1976d2;
        }
        
        .card.active {
            display: block;
            animation: fadeIn 0.4s ease-in;
        }
        
        /* PATAISYMAS 1: InstrukcijÅ³ stiliai */
        .instructions {
            background-color: #f9fafb; /* Neutralus Å¡viesus fonas */
            border: 3px solid #e5e7eb; /* Å velni kraÅ¡tinÄ— */
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            font-size: 1.15rem;
            line-height: 1.8;
            color: #1f2937;
        }

        .instructions ol {
            margin-left: 0;
            padding-left: 0;
            list-style-type: none;
            counter-reset: custom-counter;
        }

        .instructions li {
            counter-increment: custom-counter;
            margin-bottom: 10px;
            font-weight: 500;
            padding-left: 30px;
            position: relative;
        }

        .instructions li::before {
            content: counter(custom-counter) ".";
            font-weight: 900;
            color: #1976d2;
            position: absolute;
            left: 0;
        }
        .instructions strong {
             font-weight: 900;
             color: #1f2937; /* ParyÅ¡kinimas tamsiu tekstu */
        }

        /* Kita dalis (iÅ¡ paskutinio veikianÄio kodo) */
        .question-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 15px;
        }
        .question-title strong {
             font-weight: 900;
        }

        .selection-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .selection-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .btn-dalyvis { background-color: #a4d49d; color: #27541f; }
        .btn-pusdalyvis { background-color: #f2e796; color: #9e8f1c; }
        .btn-padalyvis { background-color: #c6d9f7; color: #2d4c7d; }
        .icon-book { font-size: 1.5rem; margin-bottom: 5px; }

        .sentence-container {
            background-color: #f9fafb;
            border: 3px solid #7cb3e9;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            font-size: 1.5rem;
            line-height: 2;
            text-align: center;
        }
        
        .word {
            display: inline-block;
            padding: 5px 10px;
            margin: 0 3px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        /* ... (visi kiti stiliai likÄ™ iÅ¡ paskutinÄ—s veikianÄios versijos) ... */
        .action-button {
            max-width: 400px; margin: 20px auto 0; padding: 16px 32px; font-size: 1.2rem; font-weight: 700; border-radius: 12px; border: none; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: block;
        }
        .action-button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0,0,0,0.2); }
        .action-button:disabled { opacity: 0.5; cursor: not-allowed; }
        .bg-blue-600 { background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%); color: white; }
        .bg-green-600 { background: linear-gradient(135deg, #549c48 0%, #27541f 100%); color: white; }
        .bg-orange-600 { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white; }
        /* ... (RezultatÅ³, animacijos stiliai) ... */
        
        /* Mobilusis dizainas */
        @media (max-width: 768px) {
            .sentence-container { font-size: 1.2rem; padding: 20px; }
            .question-title { font-size: 1.5rem; }
            .header-container { flex-direction: column; align-items: stretch; }
            .student-info { width: 100%; }
            .action-button { max-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        
        <div class="header-container">
            <a href="/Mokyklai/" class="back-btn">â† GrÄ¯Å¾ti Ä¯ pradÅ¾iÄ…</a>
            
            <div class="student-info">
                <span>Mokinys: <strong id="studentNameDisplay"></strong></span>
                <button class="change-name-btn" onclick="changeName()">Keisti vardÄ…</button>
            </div>
        </div>

        <div id="card-instructions" class="card active">
            <h1 class="question-title">ğŸ¨ PaÅ¾ymÄ—k Å¾odÅ¾ius spalvomis</h1>

            <div class="instructions">
                <ol>
                    <li>ğŸ“– <strong>Perskaityk</strong> sakinÄ¯.</li>
                    <li>ğŸ§  <strong>Nustatyk</strong>, kuris Å¾odis yra dalyvis, pusdalyvis ar padalyvis.</li>
                    <li>ğŸ¨ <strong>Pasirink</strong> tinkamÄ… spalvÄ….</li>
                    <li>ğŸ‘† <strong>SpustelÄ—k</strong> ant Å¾odÅ¾io, kurÄ¯ nori paÅ¾ymÄ—ti.</li>
                    <li>âœ… Spausk "Pasitikrinti".</li>
                    <li>â¡ï¸ Eik prie kito sakinio.</li>
                </ol>
            </div>

            <div class="selection-buttons">
                <div class="color-option btn-dalyvis" style="border: 1px solid #15803d;">
                    <span class="icon-book">ğŸ“—</span> Dalyvis<br>Koks? Kokia?
                 </div>
                 <div class="color-option btn-pusdalyvis" style="border: 1px solid #b45309;">
                    <span class="icon-book">ğŸ“™</span> Pusdalyvis<br>KÄ… veikdamas?
                 </div>
                 <div class="color-option btn-padalyvis" style="border: 1px solid #1e40af;">
                    <span class="icon-book">ğŸ“˜</span> Padalyvis<br>Kaip? Kada?
                 </div>
            </div>
            
            <button onclick="showCard('card-task-1')" class="action-button bg-blue-600">â–¶ï¸ PradÄ—ti uÅ¾duotÄ¯</button>
        </div>

        <div id="task-cards-container"></div>

        <div id="card-results" class="card">
            <h2 class="question-title">ğŸ‰ Testo rezultatai</h2>
            <div class="result-container">
                <div class="total-score" id="total-score"></div>
                <div class="result-details" id="result-details"></div>
            </div>
            <button onclick="location.reload()" class="action-button bg-green-600">ğŸ”„ PradÄ—ti iÅ¡ naujo</button>
        </div>
    </div>

<script>
    // --- KONFIGURACIJA ---
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbzhXP3hJ6NBLOld6Gbg-tlN-Tk8BPoxx32tx9j-iKCJChVyeOpZiDyGu9g2cm6Vl0uf/exec';
    const TASK_ID = 'L0051 Dalyvis, Pusdalyvis, Padalyvis - Teksto AnalizÄ— | 10 sakiniÅ³';
    const totalQuestions = 10;
    
    // --- SAKINIÅ² DUOMENYS (10 sakiniÅ³) ---
    const SENTENCES_DATA = [
        { sentence: "PavargÄ™s berniukas grÄ¯Å¾o namo.", words: ["PavargÄ™s", "berniukas", "grÄ¯Å¾o", "namo."], correctWord: "PavargÄ™s", correctType: "Dalyvis" },
        { sentence: "Eidamas Ä¯ mokyklÄ… sutikau draugÄ….", words: ["Eidamas", "Ä¯", "mokyklÄ…", "sutikau", "draugÄ…."], correctWord: "Eidamas", correctType: "Pusdalyvis" },
        { sentence: "Saulei Å¡vieÄiant vaikai Å¾aidÄ— lauke.", words: ["Saulei", "Å¡vieÄiant", "vaikai", "Å¾aidÄ—", "lauke."], correctWord: "Å¡vieÄiant", correctType: "Padalyvis" },
        { sentence: "Skaitanti mergaitÄ— sÄ—dÄ—jo ant suolelio.", words: ["Skaitanti", "mergaitÄ—", "sÄ—dÄ—jo", "ant", "suolelio."], correctWord: "Skaitanti", correctType: "Dalyvis" },
        { sentence: "KalbÄ—damas telefonu jis vaikÅ¡Äiojo po kambarÄ¯.", words: ["KalbÄ—damas", "telefonu", "jis", "vaikÅ¡Äiojo", "po", "kambarÄ¯."], correctWord: "KalbÄ—damas", correctType: "Pusdalyvis" },
        { sentence: "Lietui lyjant mes pasilikome namuose.", words: ["Lietui", "lyjant", "mes", "pasilikome", "namuose."], correctWord: "lyjant", correctType: "Padalyvis" },
        { sentence: "ParaÅ¡ytas laiÅ¡kas gulÄ—jo ant stalo.", words: ["ParaÅ¡ytas", "laiÅ¡kas", "gulÄ—jo", "ant", "stalo."], correctWord: "ParaÅ¡ytas", correctType: "Dalyvis" },
        { sentence: "Å½iÅ«rÄ—dami filmÄ… valgÄ—me spragÄ—sius.", words: ["Å½iÅ«rÄ—dami", "filmÄ…", "valgÄ—me", "spragÄ—sius."], correctWord: "Å½iÅ«rÄ—dami", correctType: "Pusdalyvis" },
        { sentence: "Jam atÄ—jus visi nutilo.", words: ["Jam", "atÄ—jus", "visi", "nutilo."], correctWord: "atÄ—jus", correctType: "Padalyvis" },
        { sentence: "BÄ—gantis Å¡uo vijosi katÄ™.", words: ["BÄ—gantis", "Å¡uo", "vijosi", "katÄ™."], correctWord: "BÄ—gantis", correctType: "Dalyvis" }
    ];
    
    // --- BÅªSENA ---
    let questionStates = {};
    let score = 0;
    let userAnswersLog = [];
    
    // --- VARDÅ² VALDYMAS ---
    function showNamePrompt() {
        const studentName = localStorage.getItem('studentName');
        if (!studentName) {
            const name = prompt('Ä®vesk savo vardÄ…:');
            if (name && name.trim() !== '') {
                localStorage.setItem('studentName', name.trim());
                return name.trim();
            } else {
                alert('â— PraÅ¡ome Ä¯vesti vardÄ…, kad galÄ—tumÄ—te pradÄ—ti uÅ¾duotÄ¯.');
                return showNamePrompt();
            }
        }
        return studentName;
    }

    function changeName() {
        localStorage.removeItem('studentName');
        showNamePrompt();
        location.reload();
    }

    function sendResultToSheet(taskName, score) {
        const studentName = localStorage.getItem('studentName') || 'NeÅ¾inomas';
        const timestamp = new Date().toLocaleString('lt-LT');
        const data = {
            name: studentName,
            task: taskName,
            score: score,
            timestamp: timestamp
        };
        fetch(SHEET_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        }).then(() => console.log('Rezultatas sÄ—kmingai iÅ¡siÅ³stas!'))
          .catch(error => console.error('Klaida siunÄiant rezultatÄ…:', error));
    }

    // --- SPALVOS PASIRINKIMAS ---
    function selectColor(colorType, questionNum, event) {
        const state = questionStates[questionNum];
        if (state.isChecked) return;
        
        state.selectedColor = colorType;
        
        const colorOptions = document.querySelectorAll(`#card-task-${questionNum} .selection-btn`);
        colorOptions.forEach(opt => {
            opt.classList.remove('selected');
        });
        
        event.currentTarget.classList.add('selected');
    }

    // --- Å½ODÅ½IO PAÅ½YMÄ–JIMAS ---
    function highlightWord(wordElement, questionNum) {
        const state = questionStates[questionNum];
        if (state.isChecked) return;
        
        if (!state.selectedColor) {
            alert('â— Pirmiausia pasirink spalvÄ…!');
            return;
        }

        const sentenceContainer = document.getElementById(`sentence-${questionNum}`);
        const allWords = sentenceContainer.querySelectorAll('.word');
        
        // PaÅ¡alinti paryÅ¡kinimÄ… nuo visÅ³ Å¾odÅ¾iÅ³
        allWords.forEach(w => {
            w.classList.remove('highlighted-Dalyvis', 'highlighted-Pusdalyvis', 'highlighted-Padalyvis');
        });
        
        // PaÅ¾ymÄ—ti pasirinktÄ… Å¾odÄ¯
        state.selectedWord = wordElement.textContent.replace(/[.,!?]/g, '');
        
        wordElement.classList.add(`highlighted-${state.selectedColor}`);
    }

    // --- ATSAKYMO TIKRINIMAS ---
    function checkAnswer(questionNum) {
        const state = questionStates[questionNum];
        if (state.isChecked) return;
        
        const checkBtn = document.getElementById(`check-btn-${questionNum}`);
        
        if (!state.selectedWord || !state.selectedColor) {
            alert('â— Pasirink spalvÄ… ir paÅ¾ymÄ—k Å¾odÄ¯!');
            return;
        }

        state.isChecked = true;
        
        const questionData = SENTENCES_DATA[questionNum - 1];
        const correctWord = questionData.correctWord;
        const correctType = questionData.correctType;
        
        // Tikrinimas: turi sutapti IR Å½ODIS, IR SPALVA
        const isCorrect = (state.selectedWord === correctWord && state.selectedColor === correctType);
        
        const feedbackEl = document.getElementById(`feedback-${questionNum}`);
        const sentenceContainer = document.getElementById(`sentence-${questionNum}`);
        const allWords = sentenceContainer.querySelectorAll('.word');
        
        // Rasti teisingÄ… Å¾odÄ¯ ir paÅ¾ymÄ—ti
        allWords.forEach(w => {
            const wordText = w.textContent.replace(/[.,!?]/g, '');
            w.style.cursor = 'default';
            
            if (wordText === correctWord) {
                // Teisingas Å¾odis visada yra Å¾alios spalvos (correct-answer)
                w.classList.remove('highlighted-Dalyvis', 'highlighted-Pusdalyvis', 'highlighted-Padalyvis');
                w.classList.add('correct-answer');
            } else if (wordText === state.selectedWord) {
                // Pasirinktas, bet neteisingas Å¾odis (wrong-answer)
                if (wordText !== correctWord) {
                    w.classList.add('wrong-answer');
                }
            }
        });

        if (isCorrect) {
            score++;
            feedbackEl.innerHTML = `âœ… <strong>Teisingai!</strong> Å½odis "<strong>${correctWord}</strong>" yra <strong>${correctType}</strong>.`;
            feedbackEl.className = 'feedback correct show';
        } else {
            feedbackEl.innerHTML = `âŒ <strong>Neteisingai.</strong> Teisingas atsakymas: Å¾odis "<strong>${correctWord}</strong>" yra <strong>${correctType}</strong>.`;
            feedbackEl.className = 'feedback incorrect show';
        }

        // Ä®raÅ¡yti atsakymÄ…
        userAnswersLog.push({
            sentence: questionData.sentence,
            selectedWord: state.selectedWord,
            selectedType: state.selectedColor,
            correctWord: correctWord,
            correctType: correctType,
            isCorrect: isCorrect
        });

        checkBtn.style.display = 'none';

        const nextBtn = document.getElementById(`next-btn-${questionNum}`);
        nextBtn.style.display = 'block';
    }

    // --- KORTELIÅ² GENERAVIMAS ---
    function generateTaskCards() {
        const container = document.getElementById('task-cards-container');
        
        SENTENCES_DATA.forEach((sentenceData, index) => {
            const questionNum = index + 1;
            const cardId = `card-task-${questionNum}`;
            
            // Inicializuoti bÅ«senÄ…
            questionStates[questionNum] = { selectedColor: null, selectedWord: null, isChecked: false };
            
            const cardDiv = document.createElement('div');
            cardDiv.id = cardId;
            cardDiv.className = 'card';
            
            const wordsHtml = sentenceData.words.map(word => 
                `<span class="word" onclick="highlightWord(this, ${questionNum})">${word}</span>`
            ).join(' ');

            const isLastQuestion = questionNum === totalQuestions;

            cardDiv.innerHTML = `
                <h2 class="question-title">Sakinys <strong>${questionNum}</strong> iÅ¡ <strong>${totalQuestions}</strong></h2>

                <div class="instructions">
                    <ol>
                        <li>ğŸ“– <strong>Perskaityk</strong> sakinÄ¯.</li>
                        <li>ğŸ§  <strong>Nustatyk</strong>, kuris Å¾odis yra dalyvis, pusdalyvis ar padalyvis.</li>
                        <li>ğŸ¨ <strong>Pasirink</strong> tinkamÄ… spalvÄ….</li>
                        <li>ğŸ‘† <strong>SpustelÄ—k</strong> ant Å¾odÅ¾io, kurÄ¯ nori paÅ¾ymÄ—ti.</li>
                        <li>âœ… Spausk "Pasitikrinti".</li>
                    </ol>
                </div>

                <div class="sentence-container" id="sentence-${questionNum}">
                    ${wordsHtml}
                </div>

                <div class="selection-buttons">
                    <div class="selection-btn btn-dalyvis" onclick="selectColor('Dalyvis', ${questionNum}, event)">
                        <span class="icon-book">ğŸ“—</span> Dalyvis<br>Koks? Kokia?
                    </div>
                    <div class="selection-btn btn-pusdalyvis" onclick="selectColor('Pusdalyvis', ${questionNum}, event)">
                        <span class="icon-book">ğŸ“™</span> Pusdalyvis<br>KÄ… veikdamas?
                    </div>
                    <div class="selection-btn btn-padalyvis" onclick="selectColor('Padalyvis', ${questionNum}, event)">
                        <span class="icon-book">ğŸ“˜</span> Padalyvis<br>Kaip? Kada?
                    </div>
                </div>

                <div id="feedback-${questionNum}" class="feedback"></div>

                <button id="check-btn-${questionNum}" onclick="checkAnswer(${questionNum})" class="action-button bg-blue-600">
                    âœ… Pasitikrinti
                </button>

                <button id="next-btn-${questionNum}" onclick="nextQuestion(${questionNum})" class="action-button bg-blue-600" style="display: none;">
                    ${isLastQuestion ? 'ğŸ Rezultatai' : 'â¡ï¸ Toliau'}
                </button>
            `;
            
            container.appendChild(cardDiv);
        });
    }

    // --- NAVIGACIJA ---
    function showCard(cardId) {
        document.querySelectorAll('.card').forEach(card => {
            card.classList.remove('active');
        });
        document.getElementById(cardId).classList.add('active');
        window.scrollTo(0, 0);
    }

    function nextQuestion(currentNum) {
        if (currentNum < totalQuestions) {
            showCard(`card-task-${currentNum + 1}`);
        } else {
            showResults();
        }
    }

    function showResults() {
        showCard('card-results');
        
        const totalScoreEl = document.getElementById('total-score');
        const resultDetailsEl = document.getElementById('result-details');
        
        const percentage = Math.round((score / totalQuestions) * 100);
        
        totalScoreEl.innerHTML = `
            <div>Teisingai atsakyta:</div>
            <div style="font-size: 3rem; margin: 20px 0;"><strong>${score}</strong> iÅ¡ <strong>${totalQuestions}</strong></div>
            <div class="score-percentage">${percentage}%</div>
        `;
        
        // Detali suvestinÄ—
        let detailsHTML = '';
        userAnswersLog.forEach((answer, index) => {
            const itemClass = answer.isCorrect ? 'correct' : 'incorrect';
            const icon = answer.isCorrect ? 'âœ…' : 'âŒ';
            
            detailsHTML += `
                <div class="result-item ${itemClass}">
                    ${icon} <strong>Sakinys ${index + 1}:</strong> "${answer.sentence}"<br>
                    <span style="margin-left: 30px;">
                        Pasirinkta: <strong>${answer.selectedWord || '(nepasirinkta)'}</strong> (${answer.selectedType || ''}) 
                        ${!answer.isCorrect ? `| Teisinga: <strong>${answer.correctWord}</strong> (${answer.correctType})` : ''}
                    </span>
                </div>
            `;
        });
        resultDetailsEl.innerHTML = detailsHTML;
        
        // SiunÄiame rezultatus
        sendResultToSheet(TASK_ID, percentage);
    }

    // --- INICIALIZACIJA ---
    window.onload = function() {
        const studentName = showNamePrompt();
        document.getElementById('studentNameDisplay').textContent = studentName;
        
        // Generuojame korteles
        generateTaskCards();

        // Pradedame nuo pirmos uÅ¾duoties (ne nuo instrukcijÅ³ kortelÄ—s, kuri buvo paÅ¡alinta)
        showCard('card-task-1');
    };
</script>
</body>
</html>
